<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width,initial-scale=1.0">
    <title>AI指令：文本分析与交互式HTML生成</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js"></script>
    <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>
    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
<style>:root{--rad:4px;--text-pri:#1f2937;--text-sec:#4b5563;--bg-main:#fff;--bg-page:#f3f4f6;--bg-panel:#f9fafb;--bord-soft:#e5e7eb;--bord-med:#d1d5db;--brand:#2563eb;--brand-light:#dbeafe;--anim-fast:.25s;--anim-norm:.4s;--map-node-active-stroke:var(--brand);--map-node-active-stroke-width:2.5px;--map-node-non-interactive-font-color:#6b7280;--map-node-non-interactive-border-color:#adb5bd}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji';line-height:1.65;margin:0;background-color:var(--bg-page);color:var(--text-pri)}.pw{max-width:1366px;margin:16px auto;padding:0 24px}.cc{background-color:var(--bg-main);box-shadow:0 2px 8px #0000000f;border-radius:var(--rad)}.la{display:flex;border-bottom:1px solid var(--bord-soft)}.rc{flex:3;padding:24px 32px;border-right:1px solid var(--bord-soft)}.ep{flex:2;padding:24px 32px;background-color:var(--bg-panel);position:-webkit-sticky;position:sticky;top:16px;max-height:calc(100vh - 32px);overflow-y:auto;align-self:flex-start}.rc h1,.ep h2{color:var(--text-pri);font-weight:600;margin-top:0;border-bottom:1px solid var(--bord-soft);padding-bottom:10px;margin-bottom:16px}.rc h1{font-size:1.75rem}.ep h2{font-size:1.375rem}.msh{display:flex;justify-content:space-between;align-items:center;padding:16px 32px 8px;border-bottom:1px solid var(--bord-soft);margin-bottom:16px}.msh h2{font-size:1.375rem;color:var(--text-pri);font-weight:600;margin:0;padding:0;border-bottom:none;flex-grow:1}.mhc{display:flex;gap:8px}p,ol,ul{margin-bottom:1.2em}ol,ul{padding-left:20px}.tm{padding:.1em .3em;margin:0 .05em;border-radius:3px;cursor:pointer;transition:background-color var(--anim-fast) ease,box-shadow var(--anim-fast) ease,color var(--anim-fast) ease;border:1px solid transparent;position:relative}.tm:hover{box-shadow:0 0 4px #0000001a}.tmc{background-color:#fef3c7;border-color:#fde68a}.tmb{background-color:#d1fae5;border-color:#a7f3d0}.tmt{background-color:#dbeafe;border-color:#bfdbfe}.tma{background-color:#fee2e2;border-color:#fecaca}.ei .tm{background-color:var(--brand-light);border:1px solid var(--brand);color:var(--brand)}.ei .tm:hover{background-color:var(--brand);color:white}.tm.active{background-color:var(--brand);color:white;border-color:var(--brand);box-shadow:0 0 6px #2563eb66}@keyframes slideUpFadeIn{0%{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}@keyframes simpleFadeIn{0%{opacity:0}to{opacity:1}}#explain-content>.ph{color:var(--text-sec);font-style:italic;text-align:center;margin-top:40px;animation:simpleFadeIn var(--anim-norm) ease-out forwards}#explain-content>.ei{margin-bottom:16px;padding:16px;background-color:var(--bg-main);border:1px solid var(--bord-soft);border-left:4px solid var(--brand);border-radius:var(--rad);box-shadow:0 1px 3px #0000000a;animation:slideUpFadeIn var(--anim-norm) ease-out forwards}.eih{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.eih h3{margin-top:0;font-size:1.125rem;color:var(--brand);margin-bottom:0;flex-grow:1}.gsb{background:0 0;border:none;padding:4px;cursor:pointer;color:#9ca3af;display:inline-flex;align-items:center;margin-left:8px;line-height:1}.gsb svg{width:1.1em;height:1.1em}.gsb:hover{opacity:.8}.ei p{margin-bottom:.75em;font-size:.9rem}.ei strong{color:#374151;font-weight:600}.ei p:last-child{margin-bottom:0}.ms{background-color:var(--bg-main)}#map-canvas-wrap{padding:16px 32px 24px;box-sizing:border-box;position:relative;overflow:hidden}#map-out{display:flex;justify-content:center;align-items:center;min-height:300px;border:1px solid var(--bord-soft);border-radius:var(--rad);background-color:#fdfdfe;transition:opacity var(--anim-fast) ease-in-out}#map-out.ld{opacity:.5}#map-out svg{display:block;width:100%;max-width:100%;height:auto;max-height:100%}#map-out svg .node{cursor:pointer}#map-out svg .node[data-ia=false]{cursor:default}#map-out svg .node.mna>polygon,#map-out svg .node.mna>ellipse{stroke:var(--map-node-active-stroke)!important;stroke-width:var(--map-node-active-stroke-width)!important;transition:stroke var(--anim-fast) ease,stroke-width var(--anim-fast) ease}#map-out svg .edge text{cursor:pointer}.mcb{padding:6px 10px;background-color:#f9fafb;color:var(--text-sec);border:1px solid var(--bord-med);border-radius:var(--rad);cursor:pointer;font-size:.75rem;z-index:10;transition:background-color var(--anim-fast) ease,color var(--anim-fast) ease,border-color var(--anim-fast) ease;font-family:inherit;line-height:1.2;display:inline-flex;align-items:center;gap:5px}.mcb:hover{background-color:#f3f4f6;color:var(--text-pri);border-color:#9ca3af}.mcb:disabled{cursor:not-allowed;opacity:.7}.mcb svg{width:1.1em;height:1.1em;vertical-align:middle;fill:currentColor}#map-layout-btn{width:75px;justify-content:center}#map-download-btn svg{transform:translateY(1px)}#map-zoom-modal{display:flex;position:fixed;top:0;left:0;width:100%;height:100%;background-color:#1f2937d9;z-index:1000;justify-content:center;align-items:center;overflow:hidden;backdrop-filter:blur(2px);opacity:0;visibility:hidden;transform:scale(.95) translateY(10px);transition:opacity var(--anim-fast) ease-out,transform var(--anim-fast) ease-out,visibility 0s linear var(--anim-fast)}#map-zoom-modal.vis{opacity:1;visibility:visible;transform:scale(1) translateY(0);transition-delay:0s}#map-zoom-display{position:relative;width:95%;height:95%;background-color:var(--bg-main);overflow:hidden;display:flex;justify-content:center;align-items:center;border-radius:calc(var(--rad)*1.5);box-shadow:0 10px 30px #00000026}#map-zoom-display svg{max-width:none;max-height:none;width:100%;height:100%;cursor:grab;display:block}.rc code{background-color:var(--bg-page);padding:.1em .3em;border-radius:3px;font-size:.9em}.rc pre{background-color:var(--bg-page);padding:1em;border-radius:var(--rad);overflow-x:auto;margin-bottom:1.2em;font-size:.9em}.rc pre code{background-color:transparent;padding:0;border-radius:0;font-size:1em}#map-zoom-display svg:active{cursor:grabbing}#close-map-zoom-btn{position:absolute;top:16px;right:16px;background:#374151b3;color:white;border:none;border-radius:50%;width:36px;height:36px;font-size:20px;line-height:36px;text-align:center;cursor:pointer;z-index:1001;transition:background-color var(--anim-fast) ease,transform .15s ease}#close-map-zoom-btn:hover{background:#1f2937e6;transform:scale(1.05)}#gsp{position:fixed;background-color:#fff;color:#333;padding:6px 12px;border-radius:var(--rad);font-size:.8rem;font-weight:500;z-index:1050;border:1px solid #ccc;cursor:pointer;box-shadow:0 3px 8px #00000026;opacity:0;visibility:hidden;transition:opacity .15s ease,visibility 0s linear .15s,transform .15s ease;transform:translateY(8px) scale(.95);white-space:nowrap;display:inline-flex;align-items:center}#gsp.vis{opacity:1;visibility:visible;transform:translateY(0) scale(1);transition-delay:0s,0s,0s}#gsp svg{width:1.1em;height:1.1em;vertical-align:middle;margin-right:6px}#gsp:hover{background-color:#f8f9fa;border-color:#bbb}#pfb{position:fixed;top:16px;right:16px;z-index:1005;background-color:#ffffffd9;border:1px solid var(--bord-med);border-radius:50%;width:36px;height:36px;padding:0;display:flex;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 1px 4px #0000001a;transition:background-color var(--anim-fast) ease,border-color var(--anim-fast) ease}#pfb:hover{background-color:white;border-color:var(--text-sec)}#pfb svg{width:18px;height:18px;fill:var(--text-sec);transition:fill var(--anim-fast) ease}#pfb:hover svg{fill:var(--text-pri)}}@media (max-width:900px){.pw{margin:0;padding:0}.cc{border-radius:0;box-shadow:none}.la{flex-direction:column}.rc{border-right:none;border-bottom:1px solid var(--bord-soft);padding:20px}.ep{padding:20px;min-height:200px;position:static;height:auto;max-height:none;align-self:auto}.msh{padding:16px 20px 8px;flex-wrap:wrap}.msh h2{font-size:1.25rem;width:100%;margin-bottom:8px}.mhc{width:100%;justify-content:flex-end}#map-canvas-wrap{padding:16px 20px 20px}.rc h1{font-size:1.5rem}.ep h2{font-size:1.25rem}#pfb{top:10px;right:10px}}</style>
</head>
<body>
<button id="pfb" title="全螢幕"><svg class="ie" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg><svg class="ic" style="display:none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg></button>
<div class="pw">
<div class="cc">
<div class="la">
<main class="rc">
    <h1>AI 驅動的欺詐浪潮：從 LINE 投票詐騙看企業安全新破口</h1>
    <p>本報告深入分析以 <span class="tm tmt" data-id="line_vote_scam">LINE 投票詐騙</span> 為代表的<span class="tm tmc" data-id="soc_eng_industrialization">社交工程工業化</span>趨勢，揭示了<span class="tm tmc" data-id="ai_warfare">AI 作為戰力倍增器</span>對<span class="tm tmb" data-id="corp_safety_boundary">企業安全邊界</span>帶來的根本性衝擊。</p>

    <h2>一、現代釣魚攻擊的解剖學：LINE 2.0 詐騙手法</h2>
    <p>LINE 詐騙已從傳統的憑證竊取（Scam 1.0）演進為心理作戰的 <span class="tm tmb" data-id="scam_2_0">2.0 版本</span>，其核心流程包含三個關鍵環節：</p>
    <ol>
        <li><strong>社交誘餌：</strong> 透過 <span class="tm tma" data-id="trust_familiarity">信任聯繫人與熟悉感</span>，發出看似無害的請求（如寵物比賽投票），以<span class="tm tmt" data-id="lower_alertness">繞過理性審查，降低警覺性</span>。</li>
        <li><strong>技術陷阱（憑證竊取）：</strong> 受害者被導向 <span class="tm tma" data-id="phishing_site">偽造的投票或登入網站</span>，要求輸入電話、密碼，以及致命的 <span class="tm tmc" data-id="sms_code_theft">簡訊認證碼</span>。</li>
        <li><strong>致命一擊（擴大損害）：</strong> 攻擊者立即執行 <span class="tm tmb" data-id="secondary_scam">「二次詐騙」</span>，冒充朋友/警方傳送「假的破解教學」，目的是製造 <span class="tm tmc" data-id="time_gap">關鍵時間差</span>，阻斷受害者自救，鞏固帳號控制權。</li>
    </ol>
    <p>最終，被盜帳號會被 <span class="tm tmt" data-id="account_weaponization">武器化</span>，向通訊錄發動 <span class="tm tma" data-id="chain_reaction">連鎖反應式詐騙</span>（如緊急借錢），導致金錢損失。</p>

    <h2>二、AI 戰力倍增器：將網路犯罪工業化</h2>
    <p>生成式 AI 技術的普及，使社交工程從「手工業」轉變為「工業化」流程：</p>
    <ul>
        <li><strong>完善敘事 (LLM)：</strong> <span class="tm tmt" data-id="llm_perfect_narrative">大型語言模型 (LLM) 消除語法破綻</span>，大規模生成 <span class="tm tma" data-id="hyper_personalized_script">高度個人化的詐騙劇本</span>，使攻擊難以識別。</li>
        <li><strong>合成偽裝 (Deepfake)：</strong> <span class="tm tmt" data-id="deepfake_voice_video">AI 語音與影像複製技術</span>（深度偽造）被用於 <span class="tm tma" data-id="brand_hijacking">品牌劫持</span>和高階身分冒用（如偽造高管通話）。</li>
        <li><strong>攻擊即服務：</strong> AI <span class="tm tmc" data-id="ai_lowers_barrier">降低了犯罪門檻</span>，使技術有限的攻擊者能在幾分鐘內完成 <span class="tm tmb" data-id="crime_industrialization">網路犯罪的工業化</span>（如快速架設逼真釣魚網站）。這打破了「規模與精密度」的權衡關係，大幅提高了攻擊者的 <span class="tm tmt" data-id="roi_surge">投資回報率 (ROI)</span>。</li>
    </ul>

    <h2>三、圍城下的企業：風險矩陣與邊界瓦解</h2>
    <p>AI 詐騙對企業構成雙重威脅：</p>
    <ul>
        <li><strong>直接攻擊：</strong> <span class="tm tma" data-id="brand_damage">品牌被冒用</span>，導致商譽侵蝕、客戶流失和高昂的 <span class="tm tmt" data-id="crisis_management_cost">危機管理成本</span>。</li>
        <li><strong>間接入侵（員工成為破口）：</strong> <span class="tm tmb" data-id="human_firewall_breach">員工個人帳號失陷</span>迅速演變為企業災難：
            <ul>
                <li><span class="tm tmc" data-id="credential_reuse_risk">憑證重用風險</span>：竊取的個人密碼用於登入企業系統（Email/VPN）。</li>
                <li><span class="tm tmc" data-id="intel_gathering_platform">情資蒐集跳板</span>：被駭帳號用於學習企業內部資訊，發動 <span class="tm tmt" data-id="targeted_spear_phishing">針對性魚叉式釣魚</span>。</li>
                <li><span class="tm tmc" data-id="malware_spread">惡意軟體傳播</span>：透過信任的同事帳號散播惡意連結/附件。</li>
            </ul>
        </li>
    </ul>
    <p>這導致傳統的 <span class="tm tma" data-id="traditional_security_model">安全邊界模型</span> 瓦解，<span class="tm tmt" data-id="whole_digital_life">員工整個數位生活</span>成為企業攻擊面的一部分。</p>

    <h2>四、企業韌性框架：主動防禦策略</h2>
    <p>企業需要多層次的 <span class="tm tmb" data-id="resilience_framework">韌性框架</span>：</p>
    <ol>
        <li><strong>危機應變劇本：</strong> <span class="tm tma" data-id="incident_response">即時行動協議</span>（蒐證、公開溝通、向平台下架、啟動法律程序）。</li>
        <li><strong>鞏固人體防火牆：</strong> 進化 <span class="tm tmt" data-id="employee_training">員工訓練</span>，從識別錯別字轉向培養 <span class="tm tmc" data-id="digital_skepticism">數位懷疑論</span>，強制執行 <span class="tm tma" data-id="oob_verification">帶外驗證 (OOB)</span>。</li>
        <li><strong>技術性反制：</strong> 導入 <span class="tm tmb" data-id="zero_trust">零信任架構</span>（「從不信任，永遠驗證」），強制 <span class="tm tmt" data-id="mfa_deployment">多重要素驗證 (MFA)</span>，部署 <span class="tm tmt" data-id="ai_mail_filter">AI 驅動郵件過濾</span>與 <span class="tm tmt" data-id="edr_system">EDR 系統</span>。</li>
        <li><strong>主動式品牌護盾：</strong> <span class="tm tma" data-id="asset_monitoring">自動化監控</span>網域/社群媒體冒用，並建立 <span class="tm tmc" data-id="trust_safety_team">跨職能數位信任與安全團隊</span>。</li>
    </ol>

    <h2>五、以 AI 對抗 AI：防禦的未來</h2>
    <p>一場 <span class="tm tmc" data-id="ai_arms_race">攻防 AI 的軍備競賽</span> 正在展開：</p>
    <ul>
        <li><strong>AI 哨兵：</strong> 防禦性 AI 利用 <span class="tm tmt" data-id="behavioral_analysis">行為分析</span> 建立基準模型，即時偵測 <span class="tm tma" data-id="anomaly_detection">異常行為</span> 和 <span class="tm tmc" data-id="zero_day_attack">零日攻擊</span>。</li>
        <li><strong>生態系免疫：</strong> 平台與電信業者部署 <span class="tm tmb" data-id="ecosystem_defense">大規模 AI 反詐欺系統</span>（如數位指紋、主動封鎖網域），建構社會層級的防護網。</li>
        <li><strong>未來挑戰：</strong> 防禦性 AI 需要提升 <span class="tm tmt" data-id="explainability">可解釋性</span>。企業防禦能力日益取決於核心技術供應商的 <span class="tm tmc" data-id="native_ai_security">原生 AI 安全實力</span>。</li>
    </ul>
</main>
<aside class="ep">
<h2>概念詳解</h2>
<div id="explain-content" aria-live="polite"><p class="ph">點選指令中的高亮術語或圖譜中的節點/關係查看相關解釋。</p></div>
</aside>
</div>
<section class="ms">
<div class="msh">
<h2>概念圖譜</h2>
<div class="mhc">
<button id="map-zoom-btn" class="mcb" title="全螢幕查看與互動"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg><span>全螢幕</span></button>
<button id="map-layout-btn" class="mcb" title="切換佈局方向">LR</button>
<button id="map-download-btn" class="mcb" title="下載關係圖 (PNG)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg><span>下載</span></button>
</div>
</div>
<div id="map-canvas-wrap"><div id="map-out"></div></div>
</section>
</div>
</div>
<div id="map-zoom-modal" class="mzm">
<div id="map-zoom-display" class="mzd"></div>
<button id="close-map-zoom-btn" class="czb" title="關閉">×</button>
</div>
<script>const notes={line_vote_scam:{t:"LINE 投票詐騙",type:"tmt",d:"近期在台灣社群中廣泛流傳的社交工程攻擊手法，誘騙用戶輸入 LINE 登入憑證和簡訊認證碼。",r:["soc_eng_industrialization","scam_2_0","sms_code_theft"]},soc_eng_industrialization:{t:"社交工程工業化",type:"concept",d:"指利用 AI 技術將社交工程攻擊提升到大規模、自動化且高度個人化的趨勢。",r:["ai_warfare","line_vote_scam","crime_industrialization"]},ai_warfare:{t:"AI 作為戰力倍增器",type:"concept",d:"AI 普及化極大提升了網路犯罪的效率與擬真度，將傳統手法推升到前所未有的威脅等級。",r:["soc_eng_industrialization","llm_perfect_narrative","deepfake_voice_video"]},corp_safety_boundary:{t:"企業安全邊界",type:"branch",d:"傳統的安全模型專注於保護網路邊界，但 AI 驅動的攻擊瓦解了這一界線，將員工個人數位生活納入企業攻擊面。",r:["human_firewall_breach","zero_trust","traditional_security_model"]},scam_2_0:{t:"詐騙 2.0 版本",type:"branch",d:"指從單純竊取憑證 (Scam 1.0) 進化到結合心理操縱 (二次詐騙) 以最大化攻擊效益的詐騙手法。",r:["line_vote_scam","trust_familiarity","secondary_scam"]},trust_familiarity:{t:"熟悉感與情感連結",type:"app",d:"攻擊者利用來自 '信任聯繫人' 的無害請求，訴諸情感與社交義務，繞過受害者的理性審查。",r:["scam_2_0","lower_alertness"]},lower_alertness:{t:"繞過理性審查/降低警覺性",type:"tmt",d:"社交誘餌的設計目標，使其看起來個人化且無傷大雅，從而讓受害者放鬆資安警惕。",r:["trust_familiarity"]},phishing_site:{t:"偽造的投票/登入網站",type:"app",d:"用於竊取憑證的技術陷阱，視覺上高度仿製官方頁面，並要求用戶「連動 LINE 帳號」。",r:["sms_code_theft"]},sms_code_theft:{t:"簡訊認證碼竊取",type:"concept",d:"攻擊流程中最致命的一步，攻擊者要求受害者輸入系統發送到手機的 SMS 認證碼，一旦取得即能完全接管帳號。",r:["line_vote_scam","phishing_site"]},secondary_scam:{t:"二次詐騙",type:"branch",d:"攻擊者盜號後，立即冒充朋友或警方傳送 '假帳號破解教學'，目的是製造時間差，阻斷受害者自救。",r:["scam_2_0","time_gap"]},time_gap:{t:"關鍵時間差",type:"concept",d:"二次詐騙手法的核心目的，透過誤導受害者（如刪除 APP、重啟手機）爭取不受干擾的黃金時間，以鞏固帳號控制權。",r:["secondary_scam"]},account_weaponization:{t:"帳號武器化",type:"tmt",d:"攻擊者鞏固對被盜帳號的控制權後，利用該帳號冒充受害者，向其通訊錄發送緊急求助訊息。",r:["chain_reaction"]},chain_reaction:{t:"連鎖反應式詐騙",type:"app",d:"一個被盜帳號成為發動數十次甚至數百次新攻擊的跳板，使詐騙行為病毒式傳播。",r:["account_weaponization"]},crime_industrialization:{t:"網路犯罪的工業化",type:"branch",d:"利用 AI 自動化整個攻擊鏈，大規模生產精密釣魚訊息、偽冒網站等詐騙工具。",r:["soc_eng_industrialization","ai_lowers_barrier","roi_surge"]},ai_lowers_barrier:{t:"AI 降低犯罪門檻",type:"concept",d:"生成式 AI 大幅降低了發動精密攻擊所需的時間、成本與技術門檻，使技術有限的攻擊者也能快速部署複雜攻擊。",r:["crime_industrialization"]},roi_surge:{t:"投資回報率 (ROI) 飆升",type:"tmt",d:"由於發動高品質攻擊的成本急劇下降，而潛在成功率大幅提升，網路犯罪的經濟學模型發生根本性轉變。",r:["crime_industrialization"]},llm_perfect_narrative:{t:"LLM 消除語法破綻",type:"tmt",d:"大型語言模型能將粗糙的詐騙草稿改寫成文法完美、語氣流暢的文本，消除傳統詐騙的識別指標。",r:["ai_warfare","hyper_personalized_script"]},hyper_personalized_script:{t:"高度個人化詐騙劇本",type:"app",d:"LLM 分析竊取的資料，模仿被冒充者的寫作風格與溝通模式，打造幾可亂真的詐騙郵件（如 BEC）。",r:["llm_perfect_narrative"]},deepfake_voice_video:{t:"AI 語音/影像複製技術 (Deepfake)",type:"tmt",d:"利用 AI 製造逼真的合成語音與影像內容，用於更高階的身分冒用、品牌劫持或偽造高管視訊通話。",r:["ai_warfare","brand_hijacking"]},brand_hijacking:{t:"品牌劫持",type:"app",d:"攻擊者盜用企業品牌、商標或員工形象，製作虛假內容（如廣告、促銷），誘騙消費者或客戶。",r:["deepfake_voice_video","brand_damage"]},brand_damage:{t:"商譽侵蝕與客戶信任流失",type:"app",d:"企業品牌被詐騙集團使用，導致消費者將負面體驗與真實品牌聯繫，造成客戶流失和商譽受損。",r:["brand_hijacking","crisis_management_cost"]},crisis_management_cost:{t:"危機管理與修復成本",type:"tmt",d:"企業應對品牌被冒用事件時，在公開聲明、處理投訴、法律訴訟和商譽修復上耗費的大量資源。",r:["brand_damage","incident_response"]},human_firewall_breach:{t:"人體防火牆破口",type:"branch",d:"員工個人數位生活（如 LINE）成為企業防禦體系中最脆弱的環節，個人失陷迅速蔓延至企業內部。",r:["corp_safety_boundary","credential_reuse_risk","intel_gathering_platform","malware_spread"]},credential_reuse_risk:{t:"憑證重用風險",type:"concept",d:"員工在個人與工作帳號間使用相同或相似密碼，使攻擊者能利用竊取的個人密碼入侵企業系統。",r:["human_firewall_breach"]},intel_gathering_platform:{t:"情資蒐集跳板",type:"concept",d:"被駭個人帳號為攻擊者提供了豐富的內部情資（組織架構、專案細節），用於發動更針對性的二次攻擊。",r:["human_firewall_breach","targeted_spear_phishing"]},malware_spread:{t:"惡意軟體傳播",type:"concept",d:"利用被盜帳號向同事發送惡意連結或附件，由於來自信任來源，感染機率大幅提高。",r:["human_firewall_breach"]},targeted_spear_phishing:{t:"針對性魚叉式釣魚",type:"tmt",d:"利用從被駭帳號中蒐集到的內部情資，量身打造極具說服力的郵件，鎖定高價值目標（如財務長）。",r:["intel_gathering_platform"]},traditional_security_model:{t:"傳統安全邊界模型",type:"app",d:"專注於保護網路邊界（如防火牆、入侵偵測系統），在新威脅環境下有效性降低。",r:["corp_safety_boundary","zero_trust"]},whole_digital_life:{t:"員工整個數位生活",type:"tmt",d:"AI 社交工程攻擊使企業資安長的職責擴大，必須將員工的個人數位活動視為企業攻擊面的一部分。",r:["corp_safety_boundary"]},resilience_framework:{t:"企業韌性框架",type:"branch",d:"一套多層次、系統性的戰略框架，涵蓋技術防禦、人員訓練、危機應變與品牌保護，以對抗 AI 驅動的威脅。",r:["incident_response","employee_training","zero_trust","asset_monitoring"]},incident_response:{t:"危機應變劇本",type:"app",d:"預先定義的分秒必爭的行動協議，用於應對品牌冒用事件，包括蒐證、公開溝通、向平台下架和啟動法律程序。",r:["resilience_framework","crisis_management_cost"]},employee_training:{t:"進化員工訓練",type:"tmt",d:"培訓重點從識別低階錯誤轉向培養數位懷疑論，使用 AI 生成的逼真攻擊模擬，並建立強制驗證協議。",r:["resilience_framework","digital_skepticism","oob_verification"]},digital_skepticism:{t:"數位懷疑論",type:"concept",d:"員工在面對任何製造 '緊迫感' 或偏離正常流程的數位請求時，應保持的根深蒂固的懷疑心態。",r:["employee_training"]},oob_verification:{t:"帶外驗證 (OOB)",type:"app",d:"對於敏感請求（如資金轉移、密碼重設），員工必須通過獨立且安全的渠道（如撥打官方電話）進行二次驗證。",r:["employee_training"]},zero_trust:{t:"零信任 (Zero Trust) 架構",type:"branch",d:"以身分驗證為核心的安全模型，核心原則是 '從不信任，永遠驗證'，預設不信任任何用戶或設備的存取請求。",r:["resilience_framework","traditional_security_model","mfa_deployment","ai_mail_filter","edr_system"]},mfa_deployment:{t:"多重要素驗證 (MFA)",type:"tmt",d:"強制啟用所有企業應用的登入，即使密碼被竊，攻擊者也因缺乏第二個驗證因子而無法登入。",r:["zero_trust"]},ai_mail_filter:{t:"AI 驅動郵件過濾",type:"tmt",d:"利用 NLP 分析郵件的語氣、意圖、上下文，以識別精密的 BEC 和魚叉式釣魚攻擊。",r:["zero_trust"]},edr_system:{t:"端點偵測與應變 (EDR)",type:"tmt",d:"在員工裝置上部署 EDR 解決方案，持續監控可疑活動，一旦偵測到感染能立即發出警報並自動隔離。",r:["zero_trust"]},asset_monitoring:{t:"主動式數位資產監控",type:"app",d:"利用自動化工具持續掃描網路，監測是否有未經授權使用公司品牌名稱、商標或高管姓名的行為。",r:["resilience_framework"]},trust_safety_team:{t:"跨職能數位信任與安全團隊",type:"concept",d:"整合資安、法務、公關、客服等部門的常設作戰單位，被賦予即時決策權，以應對瞬息萬變的威脅。",r:["resilience_framework"]},ai_arms_race:{t:"攻防 AI 的軍備競賽",type:"concept",d:"攻擊性 AI 與防禦性 AI 之間持續升級的對抗，這將決定未來網路空間的安全格局。",r:["ecosystem_defense","explainability","native_ai_security"]},ecosystem_defense:{t:"大規模 AI 反詐欺系統 (生態系)",type:"branch",d:"平台與電信業者部署的社會層級防護網，利用海量數據和運算能力主動識別並封鎖偽冒網站和詐騙模式。",r:["ai_arms_race"]},explainability:{t:"AI 可解釋性",type:"tmt",d:"防禦性 AI 系統的關鍵挑戰，即不僅知道系統將某活動標記為惡意，更能理解其做出判斷的 '原因'。",r:["ai_arms_race"]},native_ai_security:{t:"原生 AI 安全實力",type:"concept",d:"指核心技術供應商（雲端服務商、電信商）在其平台內建的 AI 安全能力，成為企業選擇供應商的核心標準。",r:["ai_arms_race"]}};const typeStyles={concept:{fillcolor:"#fef3c7",cssClass:"tmc"},branch:{fillcolor:"#d1fae5",cssClass:"tmb"},tech:{fillcolor:"#dbeafe",cssClass:"tmt"},app:{fillcolor:"#fee2e2",cssClass:"tma"},default:{fillcolor:"#e0e0e0",cssClass:"tmc"}};const graphEdges="line_vote_scam -> scam_2_0 [label=\"體現了\"]; soc_eng_industrialization -> ai_warfare [label=\"加速於\"]; soc_eng_industrialization -> crime_industrialization [label=\"導致\"]; ai_warfare -> llm_perfect_narrative [label=\"通過\"]; ai_warfare -> deepfake_voice_video [label=\"通過\"]; corp_safety_boundary -> human_firewall_breach [label=\"因...而瓦解\"]; corp_safety_boundary -> traditional_security_model [label=\"取代\"]; corp_safety_boundary -> zero_trust [label=\"轉向\"]; scam_2_0 -> trust_familiarity [label=\"始於\"]; scam_2_0 -> secondary_scam [label=\"進化至\"]; trust_familiarity -> lower_alertness [label=\"實現\"]; phishing_site -> sms_code_theft [label=\"核心陷阱\"]; sms_code_theft -> account_weaponization [label=\"導致\"]; secondary_scam -> time_gap [label=\"目的在於\"]; account_weaponization -> chain_reaction [label=\"助長\"]; crime_industrialization -> ai_lowers_barrier [label=\"源於\"]; crime_industrialization -> roi_surge [label=\"導致\"]; ai_lowers_barrier -> crime_industrialization [label=\"促成\"]; llm_perfect_narrative -> hyper_personalized_script [label=\"實現\"]; deepfake_voice_video -> brand_hijacking [label=\"用於\"]; brand_hijacking -> brand_damage [label=\"造成\"]; brand_damage -> crisis_management_cost [label=\"引發\"]; human_firewall_breach -> credential_reuse_risk [label=\"造成\"]; human_firewall_breach -> intel_gathering_platform [label=\"成為\"]; human_firewall_breach -> malware_spread [label=\"用於\"]; intel_gathering_platform -> targeted_spear_phishing [label=\"助長\"]; zero_trust -> mfa_deployment [label=\"要求\"]; zero_trust -> ai_mail_filter [label=\"要求\"]; zero_trust -> edr_system [label=\"要求\"]; resilience_framework -> incident_response [label=\"需要\"]; resilience_framework -> employee_training [label=\"需要\"]; resilience_framework -> zero_trust [label=\"需要\"]; resilience_framework -> asset_monitoring [label=\"需要\"]; employee_training -> digital_skepticism [label=\"培養\"]; employee_training -> oob_verification [label=\"強制執行\"]; incident_response -> trust_safety_team [label=\"由...執行\"]; asset_monitoring -> trust_safety_team [label=\"由...執行\"]; ai_arms_race -> ecosystem_defense [label=\"包含\"]; ai_arms_race -> explainability [label=\"需提升\"]; ai_arms_race -> native_ai_security [label=\"影響\"]; ecosystem_defense -> ai_arms_race [label=\"反制\"]; crisis_management_cost -> incident_response [label=\"要求\"]; trust_safety_team -> resilience_framework [label=\"為核心\"]; line_vote_scam -> human_firewall_breach [label=\"是…的破口\"]; zero_trust -> corp_safety_boundary [label=\"是…的替代\"];";const gIcon='<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 48 48"><path fill="#EA4335" d="M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z"/><path fill="#4285F4" d="M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z"/><path fill="#FBBC05" d="M10.53 28.72c-.79-2.36-.79-4.9 0-7.27l-7.98-6.19C.92 18.05 0 21.13 0 24.27s.92 6.22 2.56 8.74l7.97-6.03z"/><path fill="#34A853" d="M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z"/><path fill="none" d="M0 0h48v48H0z"/></svg>',POPUP_Y_OFF=8;let srchPop=null,hidePopTimeout=null,selectedLabelElement=null,originalLabelFill='';function genD(rd,allN,termIds){let d=`digraph AIInstructionConcepts {graph [labelloc=t,label="AI 驅動的資安威脅與企業韌性圖譜",fontsize=16,fontname="-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif",bgcolor=transparent,rankdir="${rd}",nodesep=.4,ranksep=.6];node [fontname="-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif",fontsize=10,style=filled,shape=box,margin=".12,.06",color="#d1d5db",fontcolor="#1f2937"];edge [fontsize=9,color="#6b7280",fontname="-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif",arrowsize=.7,fontcolor="#1f2937"];`;for(const id in allN){if(id in allN){const n=allN[id];if(n.hideFromGraph)continue;const s=typeStyles[n.type]||typeStyles.default;let nodeAttrs=`label="${n.t.replace(/"/g,'\\"')}", fillcolor="${s.fillcolor}", id="node-${id}", "data-ia"="${termIds.has(id)||!!Object.values(allN).find(item=>!item.hideFromGraph&&item.r&&item.r.includes(id))}"`;if(!termIds.has(id)){nodeAttrs+=', fontcolor="var(--map-node-non-interactive-font-color)", color="var(--map-node-non-interactive-border-color)", style="filled,dashed"'}d+=`${id} [${nodeAttrs}];\n`}}d+=graphEdges.replace(/([a-zA-Z0-9_]+)\s*->\s*([a-zA-Z0-9_]+)/g,(m,p1,p2)=>`${p1}->${p2}`);return d+"\n}"}
function mkPop(){if(!srchPop){srchPop=document.createElement('button');srchPop.id='gsp';srchPop.type='button';srchPop.innerHTML=`${gIcon}<span>搜尋</span>`;document.body.appendChild(srchPop);srchPop.addEventListener('mouseover',()=>{hidePopTimeout&&clearTimeout(hidePopTimeout)});srchPop.addEventListener('mouseout',()=>{hidePopTimeout=setTimeout(()=>srchPop.classList.remove('vis'),300)});srchPop.addEventListener('click',e=>{const q=e.currentTarget.dataset.st;q&&(window.open(`https://www.google.com/search?q=${encodeURIComponent(q)}`,'_blank','noopener,noreferrer'),srchPop.classList.remove('vis'))})}}
function dnldMap(){const svgEl=document.querySelector("#map-out svg");if(!svgEl){alert("未找到關係圖SVG元素。");return}const cnv=document.createElement('canvas'),ctx=cnv.getContext('2d'),rect=svgEl.getBoundingClientRect(),scl=2;cnv.width=rect.width*scl;cnv.height=rect.height*scl;ctx.fillStyle='white';ctx.fillRect(0,0,cnv.width,cnv.height);const svgStr=new XMLSerializer().serializeToString(svgEl),img=new Image,svgBlb=new Blob([svgStr],{type:'image/svg+xml;charset=utf-8'}),url=URL.createObjectURL(svgBlb);img.onload=function(){ctx.drawImage(img,0,0,cnv.width,cnv.height);URL.revokeObjectURL(url);const pngUrl=cnv.toDataURL('image/png'),dLnk=document.createElement('a');dLnk.href=pngUrl;dLnk.download='instruction-knowledge-graph.png';document.body.appendChild(dLnk);dLnk.click();document.body.removeChild(dLnk)};img.onerror=()=>{URL.revokeObjectURL(url);alert("下載關係圖失敗：無法載入SVG圖像。")};img.src=url}
document.addEventListener('DOMContentLoaded',()=>{const qsA=s=>document.querySelectorAll(s),qs=s=>document.querySelector(s),gId=id=>document.getElementById(id),allTs=qsA('.rc .tm[data-id]'),expEl=gId('explain-content'),pfBtn=gId('pfb'),mapO=gId('map-out'),zmB=gId('map-zoom-btn'),lytB=gId('map-layout-btn'),dlB=gId('map-download-btn'),zModal=gId('map-zoom-modal'),zDisp=gId('map-zoom-display'),clzmB=gId('close-map-zoom-btn');let actT=null,actMId=null,pnz=null,curLyt='LR';const rdTIds=new Set;allTs.forEach(s=>rdTIds.add(s.dataset.id));let viz;try{viz=new Viz}catch(err){console.error("Failed to initialize Viz.js. Knowledge graph functionality will be unavailable.",err);mapO&&(mapO.innerHTML='<p style="color:red;font-size:.8em;padding:10px;">錯誤：概念圖譜庫 (Viz.js) 載入失敗。</p>');lytB&&(lytB.disabled=!0);dlB&&(dlB.disabled=!0);zmB&&(zmB.disabled=!0)}
function hiMNode(id){if(actMId){const pN=qs(`#map-out svg g.node[id="${actMId}"]`);pN&&pN.classList.remove('mna')}const mId=`node-${id}`,mN=qs(`#map-out svg g.node[id="${mId}"]`);mN?(mN.classList.add('mna'),actMId=mId):actMId=null}
function clrMHi(){if(actMId){const mN=qs(`#map-out svg g.node[id="${actMId}"]`);mN&&mN.classList.remove('mna');actMId=null}}
function shwExpl(id,fromPanel=0){if(selectedLabelElement){selectedLabelElement.style.fontWeight='normal';selectedLabelElement.style.fill=originalLabelFill;selectedLabelElement=null;originalLabelFill=''}const noteD=notes[id];actT&&actT.classList.remove('active');const tmInRc=qs(`.rc .tm[data-id="${id}"]`);tmInRc?(tmInRc.classList.add('active'),actT=tmInRc,fromPanel&&!isVis(tmInRc)&&tmInRc.scrollIntoView({behavior:'smooth',block:'center'})):actT=null;noteD&&!noteD.hideFromGraph?hiMNode(id):clrMHi();if(noteD){let h=`<div class="ei"><div class="eih"><h3>${noteD.t}</h3><button type="button" class="gsb" data-st="${noteD.t.replace(/"/g,'&quot;')}" title="用 Google 搜尋 '${noteD.t.replace(/"/g,"&quot;")}'">${gIcon}</button></div>`;noteD.d&&(h+=`<p><strong>定義：</strong> ${noteD.d}</p>`);noteD.e&&(h+=`<p><strong>例子：</strong> ${noteD.e}</p>`);if(noteD.r?.length){h+=`<p><strong>相關概念：</strong> `;h+=noteD.r.map(rId=>{const rN=notes[rId];if(!rN)return`<span class="tm tmc" data-id="${rId}" title="未知概念">${rId}</span>`;let cls='';const rTIT=qs(`.rc .tm[data-id="${rId}"]`);rTIT?(cls=Array.from(rTIT.classList).find(c=>c.startsWith('tm')&&c.length===3),cls||(cls=(typeStyles[rN.type]||typeStyles.default).cssClass)):cls=(typeStyles[rN.type]||typeStyles.default).cssClass;return`<span class="tm ${cls}" data-id="${rId}" title="點選查看解釋">${rN.t}</span>`}).join('、 ');h+='</p>'}expEl.innerHTML=h+'</div>';MathJax?.typesetPromise?.([expEl]).catch(err=>console.error('MathJax typeset error:',err))}else expEl.innerHTML='<p class="ph">未找到此術語的解釋。</p>'}
function isVis(el){const rect=el.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}
function clrExpl(){actT&&actT.classList.remove('active');actT=null;clrMHi();if(selectedLabelElement){selectedLabelElement.style.fontWeight='normal';selectedLabelElement.style.fill=originalLabelFill;selectedLabelElement=null;originalLabelFill=''}expEl.innerHTML='<p class="ph">點選指令中的高亮術語或圖譜中的節點/關係查看相關解釋。</p>'}
const firstT=qs('.rc .tm.tmc[data-id]');allTs.forEach(s=>s.addEventListener('click',function(){this===actT&&expEl.querySelector('.ei h3')?.textContent===notes[this.dataset.id]?.t?clrExpl():shwExpl(this.dataset.id)}));
expEl.addEventListener('click',e=>{const t=e.target.closest('.tm'),b=e.target.closest('.gsb');if(t?.dataset.id){const curExplH3=expEl.querySelector('.ei h3');notes[t.dataset.id]&&curExplH3&&curExplH3.textContent===notes[t.dataset.id].t?(qs(`.rc .tm.active[data-id="${t.dataset.id}"]`)?clrExpl():(shwExpl(t.dataset.id,1),expEl.parentElement.scrollTop=0)):(shwExpl(t.dataset.id,1),expEl.parentElement.scrollTop=0)}else b?.dataset.st&&window.open(`https://www.google.com/search?q=${encodeURIComponent(b.dataset.st)}`,'_blank','noopener,noreferrer')});
expEl.addEventListener('mouseover',e=>{const targetEl=e.target.closest('.tm');if(targetEl?.dataset.id&&targetEl.parentElement?.tagName==='P'&&targetEl.parentElement.firstChild?.tagName==='STRONG'&&targetEl.parentElement.firstChild.textContent.includes('相關概念')){mkPop();hidePopTimeout&&clearTimeout(hidePopTimeout);const id=targetEl.dataset.id,d=notes[id],sT=d?d.t:targetEl.textContent.trim();srchPop.dataset.st=sT;srchPop.querySelector('span').textContent=`搜尋 "${sT.length>18?sT.substring(0,16)+'...':sT}"`;srchPop.classList.remove('vis');const r=targetEl.getBoundingClientRect(),popW=srchPop.offsetWidth,popH=srchPop.offsetHeight;let l=r.left+r.width/2-popW/2,t=r.top-popH-POPUP_Y_OFF;l<POPUP_Y_OFF&&(l=POPUP_Y_OFF);l+popW>innerWidth-POPUP_Y_OFF&&(l=innerWidth-popW-POPUP_Y_OFF);t<POPUP_Y_OFF&&(t=r.bottom+POPUP_Y_OFF,t+popH>innerHeight-POPUP_Y_OFF&&(t=r.top+r.height/2-popH/2));srchPop.style.left=`${l}px`;srchPop.style.top=`${t}px`;srchPop.classList.add('vis')}});
expEl.addEventListener('mouseout',e=>{const targetEl=e.target.closest('.tm');targetEl?.dataset.id&&targetEl.parentElement?.tagName==='P'&&targetEl.parentElement.firstChild?.tagName==='STRONG'&&targetEl.parentElement.firstChild.textContent.includes('相關概念')&&srchPop&&(hidePopTimeout&&clearTimeout(hidePopTimeout),hidePopTimeout=setTimeout(()=>{srchPop.matches(':hover')||srchPop.classList.remove('vis')},200))});
mapO.addEventListener('click',e=>{const target=e.target;let nodeElement=null,currentElementForNodeSearch=target;while(currentElementForNodeSearch&&currentElementForNodeSearch!==mapO){if(currentElementForNodeSearch.matches?.('g.node[id^="node-"]')){nodeElement=currentElementForNodeSearch;break}currentElementForNodeSearch=currentElementForNodeSearch.parentNode}if(nodeElement){if(selectedLabelElement){selectedLabelElement.style.fontWeight='normal';selectedLabelElement.style.fill=originalLabelFill;selectedLabelElement=null;originalLabelFill=''}const id=nodeElement.id.substring(5);if(notes[id]&&!notes[id].hideFromGraph&&nodeElement.dataset.ia!=="false"){const curExplH3=expEl.querySelector('.ei h3');actMId===nodeElement.id&&curExplH3&&notes[id]&&curExplH3.textContent===notes[id].t?clrExpl():(shwExpl(id,1),expEl.parentElement.scrollTop=0)}return}if(target.localName==='text'){const parentG=target.parentNode;if(parentG?.localName==='g'&&parentG.classList.contains('edge')){const labelText=target.textContent.trim();if(labelText){actT&&(actT.classList.remove('active'),actT=null);clrMHi();if(selectedLabelElement===target){target.style.fontWeight='normal';target.style.fill=originalLabelFill;selectedLabelElement=null;originalLabelFill='';clrExpl();return}selectedLabelElement&&selectedLabelElement!==target&&(selectedLabelElement.style.fontWeight='normal',selectedLabelElement.style.fill=originalLabelFill);originalLabelFill=target.style.fill||target.getAttribute('fill')||'var(--text-pri)';target.style.fontWeight='bold';target.style.fill='var(--brand)';selectedLabelElement=target;let html=`<div class="ei"><div class="eih"><h3>關係類型: ${labelText}</h3><button type="button" class="gsb" data-st="${labelText.replace(/"/g,'&quot;')}" title="用 Google 搜尋 '${labelText.replace(/"/g,'&quot;')}'">${gIcon}</button></div><p>此標籤描述了圖譜中兩個概念之間的關係類型。</p><p>您可以使用搜尋按鈕搜尋關於“<strong>${labelText}</strong>”的更多資訊。</p></div>`;expEl.innerHTML=html;MathJax?.typesetPromise?.([expEl]).catch(err=>console.error('MathJax typeset error:',err));expEl.parentElement.scrollTop=0}}}});
const pzWheel=e=>{pnz?.zoomWithWheel&&(e.preventDefault(),pnz.zoomWithWheel(e))};
function updLBtn(){lytB.textContent=curLyt==='TB'?'LR':'TB';lytB.title=`切換到 ${curLyt==='TB'?'LR':'TB'} 佈局`}updLBtn();
async function rndrMap(rd){if(!viz||!mapO){!viz&&mapO&&!mapO.querySelector('p[style*="color:red"]')&&(mapO.innerHTML='<p style="color:red;font-size:.8em;padding:10px;">錯誤：概念圖譜庫 (Viz.js) 載入失敗。</p>');return}lytB.disabled=!0;dlB&&(dlB.disabled=!0);mapO.classList.add('ld');lytB.innerHTML='<svg viewBox="0 0 24 24" style="width:1.1em;height:1.1em;fill:currentColor"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z" opacity=".3"/><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg> <span>...</span>';if(selectedLabelElement){selectedLabelElement=null;originalLabelFill=''}const dotStr=genD(rd,notes,rdTIds);try{const svgRend=await viz.renderSVGElement(dotStr);mapO.innerHTML='';mapO.appendChild(svgRend);const activeTermId=actT?actT.dataset.id:null;activeTermId&&notes[activeTermId]&&!notes[activeTermId].hideFromGraph?hiMNode(activeTermId):actMId&&(notes[actMId.substring(5)]&&!notes[actMId.substring(5)].hideFromGraph?hiMNode(actMId.substring(5)):clrMHi());const svgCln=svgRend.cloneNode(!0);zDisp.innerHTML='';zDisp.appendChild(svgCln);const pzEl=zDisp.querySelector('svg');if(pnz?.destroy){const oldPnz=pnz.getPan()?.parentElement;oldPnz&&oldPnz.removeEventListener('wheel',pzWheel);pnz.destroy();pnz=null}pzEl&&(pnz=Panzoom(pzEl,{maxZoom:10,minZoom:.1,contain:'outside',canvas:!0,duration:200,easing:'ease-out'}),zDisp.addEventListener('wheel',pzWheel,{passive:!1}))}catch(err){console.error("Error rendering Map SVG:",err);mapO.innerHTML=`<p style="color:red;font-size:.8em;padding:10px;">概念圖渲染失敗: ${err.message}</p>`}finally{curLyt=rd;updLBtn();lytB.disabled=!1;dlB&&(dlB.disabled=!1);mapO.classList.remove('ld')}}
viz?rndrMap(curLyt).then(()=>{firstT?.dataset.id&&shwExpl(firstT.dataset.id)}):firstT?.dataset.id&&shwExpl(firstT.dataset.id);
lytB.addEventListener('click',()=>rndrMap(curLyt==='TB'?'LR':'TB'));
zmB.addEventListener('click',()=>{zModal.classList.add('vis');pnz?.reset?.({animate:!1});clzmB.focus();pfBtn&&(pfBtn.style.display='none')});
dlB?.addEventListener('click',dnldMap);function hidZm(){zModal.classList.remove('vis');pfBtn&&(pfB.style.display='flex')}clzmB.addEventListener('click',hidZm);
zModal.addEventListener('click',e=>{e.target===zModal&&hidZm()});document.addEventListener('keydown',e=>{e.key==='Escape'&&zModal.classList.contains('vis')&&hidZm()});
const fsIconE=pfBtn.querySelector('.ie'),fsIconC=pfBtn.querySelector('.ic');
function tglFs(){const doc=document;!doc.fullscreenElement&&!doc.mozFullScreenElement&&!doc.webkitFullscreenElement&&!doc.msFullscreenElement?(doc.documentElement.requestFullscreen?doc.documentElement.requestFullscreen():doc.documentElement.mozRequestFullScreen?doc.documentElement.mozRequestFullScreen():doc.documentElement.webkitRequestFullscreen?doc.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):doc.documentElement.msRequestFullscreen&&doc.documentElement.msRequestFullscreen()):doc.exitFullscreen?doc.exitFullscreen():doc.mozCancelFullScreen?doc.mozCancelFullScreen():doc.webkitExitFullscreen?doc.webkitExitFullscreen():doc.msExitFullscreen&&doc.msExitFullscreen()}
function updFsBtn(){const doc=document;doc.fullscreenElement||doc.mozFullScreenElement||doc.webkitFullscreenElement||doc.msFullscreenElement?(fsIconE.style.display='none',fsIconC.style.display='block',pfBtn.title="退出全螢幕"):(fsIconE.style.display='block',fsIconC.style.display='none',pfBtn.title="全螢幕")}
pfBtn&&(pfBtn.style.display='flex',pfBtn.addEventListener('click',tglFs),['fullscreenchange','webkitfullscreenchange','mozfullscreenchange','MSFullscreenChange'].forEach(evt=>document.addEventListener(evt,updFsBtn)),updFsBtn())});</script>
</body>
</html>