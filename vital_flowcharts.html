<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Vital CRM èˆ‡ BizForm åŒæ­¥æ¶æ§‹æµç¨‹åœ–</title>
    <script src="https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.min.js"></script>
    <style>
        body {
            font-family: 'Microsoft JhengHei', 'Noto Sans TC', sans-serif;
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }
        .diagram-container {
            background: white;
            border-radius: 8px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }
        h1 {
            color: #1976d2;
            border-bottom: 3px solid #1976d2;
            padding-bottom: 10px;
        }
        h2 {
            color: #424242;
            margin-top: 30px;
        }
        .mermaid {
            text-align: center;
            margin: 20px 0;
        }
        .description {
            background: #e3f2fd;
            padding: 15px;
            border-left: 4px solid #1976d2;
            margin: 10px 0 20px 0;
            border-radius: 4px;
        }
    </style>
</head>
<body>
    <h1>Vital CRM èˆ‡ BizForm å®¢æˆ¶è³‡æ–™åŒæ­¥è‡³ PostgreSQL æµç¨‹åœ–</h1>
    
    <div class="diagram-container">
        <h2>1ï¸âƒ£ ç³»çµ±æ¶æ§‹ç¸½è¦½</h2>
        <div class="description">
            <strong>èªªæ˜ï¼š</strong>å±•ç¤º BizFormã€Vital CRM èˆ‡ PostgreSQL è³‡æ–™å¹³å°çš„æ•´é«”æ¶æ§‹é—œä¿‚ï¼ŒåŒ…å«è³‡æ–™æµå‘èˆ‡åŒæ­¥æ©Ÿåˆ¶ã€‚
        </div>
        <div class="mermaid">
graph LR
    subgraph "å‰ç«¯ç³»çµ±"
        direction TB
        BF[Vital BizForm<br/>ğŸ“‹ è¡¨å–®ç³»çµ±]
        CRM[Vital CRM<br/>ğŸ‘¥ å®¢æˆ¶ç®¡ç†]
        BF -->|API ä¸²æ¥<br/>ä¸€éµåŒ¯å…¥| CRM
    end
    
    subgraph "åŒæ­¥æ©Ÿåˆ¶"
        direction TB
        WH[Webhook<br/>ğŸ”” å³æ™‚é€šçŸ¥]
        API[API ä»‹é¢<br/>ğŸ”Œ è³‡æ–™å­˜å–]
        N8N[n8n<br/>âš™ï¸ è‡ªå‹•åŒ–]
        
        WH --> N8N
        N8N <--> API
    end
    
    subgraph "å¾Œç«¯å¹³å°"
        PG[(PostgreSQL<br/>ğŸ—„ï¸ è³‡æ–™å¹³å°)]
    end
    
    CRM -->|æ–°å¢/æ›´æ–°è§¸ç™¼| WH
    N8N -->|å¯«å…¥è³‡æ–™| PG
    PG -.é›™å‘åŒæ­¥.-> N8N
    
    style BF fill:#e3f2fd
    style CRM fill:#fff3e0
    style PG fill:#e8f5e9
    style WH fill:#fce4ec
    style API fill:#f3e5f5
    style N8N fill:#fff9c4
        </div>
    </div>

    <div class="diagram-container">
        <h2>2ï¸âƒ£ å®Œæ•´ç³»çµ±æ¶æ§‹åœ–</h2>
        <div class="description">
            <strong>èªªæ˜ï¼š</strong>è©³ç´°å±•ç¤ºåˆå§‹è³‡æ–™æ•´åˆï¼ˆæ‰¹æ¬¡åŒ¯å‡ºï¼‰èˆ‡å³æ™‚åŒæ­¥æ©Ÿåˆ¶ï¼ŒåŒ…å«å¯é¸çš„é›™å‘åŒæ­¥è·¯å¾‘ã€‚
        </div>
        <div class="mermaid">
graph TB
    subgraph "è³‡æ–™ä¾†æº"
        BF[Vital BizForm<br/>ä¾›æ‡‰å•†ç”³è«‹è¡¨å–®]
        CRM[Vital CRM<br/>å®¢æˆ¶è³‡æ–™åº«]
    end
    
    subgraph "ä¸­ä»‹å±¤"
        API[CRM API ä»‹é¢]
        WH[Webhook é€šçŸ¥æ©Ÿåˆ¶]
        N8N[n8n æ•´åˆå·¥å…·<br/>å¯é¸]
    end
    
    subgraph "ç›®æ¨™å¹³å°"
        PG[(PostgreSQL<br/>è³‡æ–™å¹³å°)]
    end
    
    %% åˆå§‹è³‡æ–™æ•´åˆ
    BF -.æ‰¹æ¬¡åŒ¯å‡º.-> EXCEL[Excel æª”æ¡ˆ]
    CRM -.æ‰¹æ¬¡åŒ¯å‡º.-> EXCEL
    EXCEL -.è³‡æ–™æ¸…æ´—æ•´ä½µ.-> PG
    
    %% BizForm â†’ CRM â†’ PostgreSQL
    BF -->|è¡¨å–®æäº¤<br/>ä¸€éµåŒ¯å…¥| CRM
    
    %% CRM â†’ PostgreSQL å³æ™‚åŒæ­¥
    CRM -->|æ–°å¢/æ›´æ–°å®¢æˆ¶| WH
    WH -->|è§¸ç™¼é€šçŸ¥| N8N
    N8N -->|å–å¾—å®¢æˆ¶è³‡æ–™| API
    API -->|å¯«å…¥è³‡æ–™| PG
    
    %% é›™å‘åŒæ­¥ï¼ˆè™›ç·šè¡¨ç¤ºé¸ç”¨ï¼‰
    PG -.æ›´æ–°è³‡æ–™.-> API
    API -.å¯«å› CRM.-> CRM
    
    style BF fill:#e1f5ff
    style CRM fill:#fff4e1
    style PG fill:#e8f5e9
    style N8N fill:#f3e5f5
    style EXCEL fill:#fce4ec
        </div>
    </div>

    <div class="diagram-container">
        <h2>3ï¸âƒ£ å¯¦æ–½æ­¥é©Ÿæµç¨‹</h2>
        <div class="description">
            <strong>èªªæ˜ï¼š</strong>å¾åˆå§‹è³‡æ–™æ•´åˆåˆ°ä¸Šç·šé‹è¡Œçš„å®Œæ•´å¯¦æ–½æ­¥é©Ÿï¼ŒåŒ…å«å…©ç¨® BizForm åŒæ­¥æ–¹å¼çš„é¸æ“‡åˆ†æ”¯ã€‚
        </div>
        <div class="mermaid">
graph TD
    START([é–‹å§‹å¯¦æ–½]) --> STEP1[æ­¥é©Ÿ 1ï¼šåˆå§‹è³‡æ–™æ•´åˆ]
    
    STEP1 --> S1A[åŒ¯å‡º CRM æ—¢æœ‰å®¢æˆ¶è³‡æ–™]
    STEP1 --> S1B[åŒ¯å‡º BizForm è¡¨å–®è³‡æ–™]
    S1A --> S1C[è³‡æ–™æ¸…æ´—èˆ‡æ•´ä½µ]
    S1B --> S1C
    S1C --> S1D[å°å…¥ PostgreSQL æ¨™æº–å®¢æˆ¶è³‡æ–™è¡¨]
    
    S1D --> STEP2[æ­¥é©Ÿ 2ï¼šè¨­å®š CRM â†’ è³‡æ–™å¹³å°åŒæ­¥]
    
    STEP2 --> S2A[å•Ÿç”¨ CRM è‡ªå‹•åŒ–ä¸­å¿ƒ]
    S2A --> S2B[è¨­å®š Webhook è§¸ç™¼æ¢ä»¶<br/>æ–°å¢/æ›´æ–°å®¢æˆ¶æ™‚]
    S2B --> S2C[éƒ¨ç½²å¤–éƒ¨ API ç«¯é»<br/>æˆ– n8n Webhook]
    S2C --> S2D[æ¸¬è©¦å³æ™‚åŒæ­¥æ©Ÿåˆ¶]
    
    S2D --> STEP3[æ­¥é©Ÿ 3ï¼šè¨­å®š BizForm â†’ è³‡æ–™å¹³å°åŒæ­¥]
    
    STEP3 --> DECISION{é¸æ“‡æ–¹å¼}
    
    DECISION -->|æ–¹å¼ A| S3A[ç¶“ç”± CRM é–“æ¥åŒæ­¥]
    S3A --> S3A1[è¨­å®š BizForm èˆ‡ CRM API ä¸²æ¥]
    S3A1 --> S3A2[è¡¨å–®å®Œæˆå¾Œä¸€éµåŒ¯å…¥ CRM]
    S3A2 --> S3A3[é€é CRM Webhook åŒæ­¥è‡³å¹³å°]
    
    DECISION -->|æ–¹å¼ B| S3B[ç›´æ¥å‘¼å«å¤–éƒ¨ API]
    S3B --> S3B1[è¨­å®š BizForm Webhook è§¸ç™¼]
    S3B1 --> S3B2[ç›´æ¥ç™¼é€è³‡æ–™è‡³å¹³å° API]
    
    S3A3 --> STEP4[æ­¥é©Ÿ 4ï¼šè©•ä¼°é›™å‘åŒæ­¥éœ€æ±‚]
    S3B2 --> STEP4
    
    STEP4 --> DECISION2{éœ€è¦é›™å‘åŒæ­¥?}
    
    DECISION2 -->|æ˜¯| S4A[é–‹ç™¼å¹³å° â†’ CRM å›å¯«æ©Ÿåˆ¶]
    S4A --> S4B[ä½¿ç”¨ CRM API æ›´æ–°å®¢æˆ¶è³‡æ–™]
    S4B --> S4C[CRM åŒæ­¥å› BizForm]
    
    DECISION2 -->|å¦| S4D[ç¶­æŒå–®å‘åŒæ­¥å³å¯]
    
    S4C --> STEP5[æ­¥é©Ÿ 5ï¼šéƒ¨ç½²æ•´åˆå·¥å…·]
    S4D --> STEP5
    
    STEP5 --> S5A[ä½¿ç”¨ n8n å»ºç«‹å·¥ä½œæµç¨‹]
    S5A --> S5B[è¨­å®šç›£è½èˆ‡è³‡æ–™è½‰æ›é‚è¼¯]
    S5B --> S5C[æ¸¬è©¦æ‰€æœ‰åŒæ­¥è·¯å¾‘]
    S5C --> S5D[ä¸Šç·šé‹è¡Œèˆ‡ç›£æ§]
    
    S5D --> END([å®Œæˆå¯¦æ–½])
    
    style START fill:#4caf50,color:#fff
    style END fill:#4caf50,color:#fff
    style STEP1 fill:#2196f3,color:#fff
    style STEP2 fill:#2196f3,color:#fff
    style STEP3 fill:#2196f3,color:#fff
    style STEP4 fill:#2196f3,color:#fff
    style STEP5 fill:#2196f3,color:#fff
    style DECISION fill:#ff9800,color:#fff
    style DECISION2 fill:#ff9800,color:#fff
        </div>
    </div>

    <div class="diagram-container">
        <h2>4ï¸âƒ£ å³æ™‚è³‡æ–™åŒæ­¥æ™‚åºåœ–</h2>
        <div class="description">
            <strong>èªªæ˜ï¼š</strong>å±•ç¤ºå››ç¨®åŒæ­¥æƒ…å¢ƒçš„è©³ç´°äº’å‹•æµç¨‹ï¼šBizForm æ–°è¡¨å–®ã€CRM ç›´æ¥æ–°å¢ã€CRM æ›´æ–°å®¢æˆ¶ã€ä»¥åŠé›™å‘åŒæ­¥æ©Ÿåˆ¶ã€‚
        </div>
        <div class="mermaid">
sequenceDiagram
    participant BF as Vital BizForm
    participant CRM as Vital CRM
    participant WH as Webhook
    participant N8N as n8n/å¤–éƒ¨æœå‹™
    participant API as CRM API
    participant PG as PostgreSQL

    Note over BF,PG: æƒ…å¢ƒ 1ï¼šBizForm æ–°è¡¨å–®æäº¤
    
    BF->>BF: ä¾›æ‡‰å•†å¡«å¯«ç”³è«‹è¡¨å–®
    BF->>BF: è¡¨å–®æµç¨‹å®Œæˆ
    BF->>CRM: ç®¡ç†è€…é»æ“Šä¸€éµåŒ¯å…¥
    CRM->>CRM: å»ºç«‹æ–°å®¢æˆ¶ç´€éŒ„
    CRM->>WH: è§¸ç™¼ Webhook äº‹ä»¶
    WH->>N8N: POST é€šçŸ¥ï¼šæ–°å®¢æˆ¶å»ºç«‹
    N8N->>API: GET è«‹æ±‚å–å¾—å®¢æˆ¶è©³ç´°è³‡æ–™
    API-->>N8N: å›å‚³å®¢æˆ¶ JSON è³‡æ–™
    N8N->>PG: INSERT å®¢æˆ¶è³‡æ–™
    PG-->>N8N: ç¢ºèªå¯«å…¥æˆåŠŸ
    
    Note over BF,PG: æƒ…å¢ƒ 2ï¼šCRM ç›´æ¥æ–°å¢å®¢æˆ¶
    
    CRM->>CRM: æ¥­å‹™äººå“¡æ–°å¢å®¢æˆ¶
    CRM->>WH: è§¸ç™¼ Webhook äº‹ä»¶
    WH->>N8N: POST é€šçŸ¥ï¼šæ–°å®¢æˆ¶å»ºç«‹
    N8N->>API: GET è«‹æ±‚å–å¾—å®¢æˆ¶è©³ç´°è³‡æ–™
    API-->>N8N: å›å‚³å®¢æˆ¶ JSON è³‡æ–™
    N8N->>PG: INSERT å®¢æˆ¶è³‡æ–™
    PG-->>N8N: ç¢ºèªå¯«å…¥æˆåŠŸ
    
    Note over BF,PG: æƒ…å¢ƒ 3ï¼šCRM æ›´æ–°æ—¢æœ‰å®¢æˆ¶
    
    CRM->>CRM: æ›´æ–°å®¢æˆ¶è³‡è¨Š
    CRM->>WH: è§¸ç™¼ Webhook äº‹ä»¶
    WH->>N8N: POST é€šçŸ¥ï¼šå®¢æˆ¶æ›´æ–°
    N8N->>API: GET è«‹æ±‚å–å¾—æœ€æ–°è³‡æ–™
    API-->>N8N: å›å‚³æ›´æ–°å¾Œçš„è³‡æ–™
    N8N->>PG: UPDATE å®¢æˆ¶è³‡æ–™
    PG-->>N8N: ç¢ºèªæ›´æ–°æˆåŠŸ
    
    Note over BF,PG: æƒ…å¢ƒ 4ï¼šé›™å‘åŒæ­¥ï¼ˆé¸ç”¨ï¼‰
    
    PG->>PG: è³‡æ–™å¹³å°æ›´æ–°å®¢æˆ¶è³‡æ–™
    PG->>N8N: è§¸ç™¼æ›´æ–°äº‹ä»¶
    N8N->>API: PUT/PATCH æ›´æ–° CRM å®¢æˆ¶
    API->>CRM: å¯«å…¥æ›´æ–°
    CRM-->>API: ç¢ºèªæ›´æ–°
    API-->>N8N: å›å‚³æˆåŠŸ
        </div>
    </div>

    <script>
        mermaid.initialize({ 
            startOnLoad: true,
            theme: 'default',
            flowchart: {
                useMaxWidth: true,
                htmlLabels: true,
                curve: 'basis'
            },
            sequence: {
                useMaxWidth: true,
                wrap: true
            }
        });
    </script>
</body>
</html>
