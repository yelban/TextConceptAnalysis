<!DOCTYPE html>

<html lang="zh-CN">

<head>

    <meta charset="UTF-8">

    <meta name="viewport" content="width=device-width,initial-scale=1.0">

    <title>AI指令：文本分析与交互式HTML生成</title>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/viz.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/viz.js/2.1.2/full.render.js"></script>

    <script src="https://unpkg.com/@panzoom/panzoom@4.5.1/dist/panzoom.min.js"></script>

    <script async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>

<style>:root{--rad:4px;--text-pri:#1f2937;--text-sec:#4b5563;--bg-main:#fff;--bg-page:#f3f4f6;--bg-panel:#f9fafb;--bord-soft:#e5e7eb;--bord-med:#d1d5db;--brand:#2563eb;--brand-light:#dbeafe;--anim-fast:.25s;--anim-norm:.4s;--map-node-active-stroke:var(--brand);--map-node-active-stroke-width:2.5px;--map-node-non-interactive-font-color:#6b7280;--map-node-non-interactive-border-color:#adb5bd}body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif,'Apple Color Emoji','Segoe UI Emoji';line-height:1.65;margin:0;background-color:var(--bg-page);color:var(--text-pri)}.pw{max-width:1366px;margin:16px auto;padding:0 24px}.cc{background-color:var(--bg-main);box-shadow:0 2px 8px #0000000f;border-radius:var(--rad)}.la{display:flex;border-bottom:1px solid var(--bord-soft)}.rc{flex:3;padding:24px 32px;border-right:1px solid var(--bord-soft)}.ep{flex:2;padding:24px 32px;background-color:var(--bg-panel);position:-webkit-sticky;position:sticky;top:16px;max-height:calc(100vh - 32px);overflow-y:auto;align-self:flex-start}.rc h1,.ep h2{color:var(--text-pri);font-weight:600;margin-top:0;border-bottom:1px solid var(--bord-soft);padding-bottom:10px;margin-bottom:16px}.rc h1{font-size:1.75rem}.ep h2{font-size:1.375rem}.msh{display:flex;justify-content:space-between;align-items:center;padding:16px 32px 8px;border-bottom:1px solid var(--bord-soft);margin-bottom:16px}.msh h2{font-size:1.375rem;color:var(--text-pri);font-weight:600;margin:0;padding:0;border-bottom:none;flex-grow:1}.mhc{display:flex;gap:8px}p,ol,ul{margin-bottom:1.2em}ol,ul{padding-left:20px}.tm{padding:.1em .3em;margin:0 .05em;border-radius:3px;cursor:pointer;transition:background-color var(--anim-fast) ease,box-shadow var(--anim-fast) ease,color var(--anim-fast) ease;border:1px solid transparent;position:relative}.tm:hover{box-shadow:0 0 4px #0000001a}.tmc{background-color:#fef3c7;border-color:#fde68a}.tmb{background-color:#d1fae5;border-color:#a7f3d0}.tmt{background-color:#dbeafe;border-color:#bfdbfe}.tma{background-color:#fee2e2;border-color:#fecaca}.ei .tm{background-color:var(--brand-light);border:1px solid var(--brand);color:var(--brand)}.ei .tm:hover{background-color:var(--brand);color:white}.tm.active{background-color:var(--brand);color:white;border-color:var(--brand);box-shadow:0 0 6px #2563eb66}@keyframes slideUpFadeIn{0%{opacity:0;transform:translateY(15px)}to{opacity:1;transform:translateY(0)}}@keyframes simpleFadeIn{0%{opacity:0}to{opacity:1}}#explain-content>.ph{color:var(--text-sec);font-style:italic;text-align:center;margin-top:40px;animation:simpleFadeIn var(--anim-norm) ease-out forwards}#explain-content>.ei{margin-bottom:16px;padding:16px;background-color:var(--bg-main);border:1px solid var(--bord-soft);border-left:4px solid var(--brand);border-radius:var(--rad);box-shadow:0 1px 3px #0000000a;animation:slideUpFadeIn var(--anim-norm) ease-out forwards}.eih{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px}.eih h3{margin-top:0;font-size:1.125rem;color:var(--brand);margin-bottom:0;flex-grow:1}.gsb{background:0 0;border:none;padding:4px;cursor:pointer;color:#9ca3af;display:inline-flex;align-items:center;margin-left:8px;line-height:1}.gsb svg{width:1.1em;height:1.1em}.gsb:hover{opacity:.8}.ei p{margin-bottom:.75em;font-size:.9rem}.ei strong{color:#374151;font-weight:600}.ei p:last-child{margin-bottom:0}.ms{background-color:var(--bg-main)}#map-canvas-wrap{padding:16px 32px 24px;box-sizing:border-box;position:relative;overflow:hidden}#map-out{display:flex;justify-content:center;align-items:center;min-height:300px;border:1px solid var(--bord-soft);border-radius:var(--rad);background-color:#fdfdfe;transition:opacity var(--anim-fast) ease-in-out}#map-out.ld{opacity:.5}#map-out svg{display:block;width:100%;max-width:100%;height:auto;max-height:100%}#map-out svg .node{cursor:pointer}#map-out svg .node[data-ia=false]{cursor:default}#map-out svg .node.mna>polygon,#map-out svg .node.mna>ellipse{stroke:var(--map-node-active-stroke)!important;stroke-width:var(--map-node-active-stroke-width)!important;transition:stroke var(--anim-fast) ease,stroke-width var(--anim-fast) ease}#map-out svg .edge text{cursor:pointer}.mcb{padding:6px 10px;background-color:#f9fafb;color:var(--text-sec);border:1px solid var(--bord-med);border-radius:var(--rad);cursor:pointer;font-size:.75rem;z-index:10;transition:background-color var(--anim-fast) ease,color var(--anim-fast) ease,border-color var(--anim-fast) ease;font-family:inherit;line-height:1.2;display:inline-flex;align-items:center;gap:5px}.mcb:hover{background-color:#f3f4f6;color:var(--text-pri);border-color:#9ca3af}.mcb:disabled{cursor:not-allowed;opacity:.7}.mcb svg{width:1.1em;height:1.1em;vertical-align:middle;fill:currentColor}#map-layout-btn{width:75px;justify-content:center}#map-download-btn svg{transform:translateY(1px)}#map-zoom-modal{display:flex;position:fixed;top:0;left:0;width:100%;height:100%;background-color:#1f2937d9;z-index:1000;justify-content:center;align-items:center;overflow:hidden;backdrop-filter:blur(2px);opacity:0;visibility:hidden;transform:scale(.95) translateY(10px);transition:opacity var(--anim-fast) ease-out,transform var(--anim-fast) ease-out,visibility 0s linear var(--anim-fast)}#map-zoom-modal.vis{opacity:1;visibility:visible;transform:scale(1) translateY(0);transition-delay:0s}#map-zoom-display{position:relative;width:95%;height:95%;background-color:var(--bg-main);overflow:hidden;display:flex;justify-content:center;align-items:center;border-radius:calc(var(--rad)*1.5);box-shadow:0 10px 30px #00000026}#map-zoom-display svg{max-width:none;max-height:none;width:100%;height:100%;cursor:grab;display:block}.rc code{background-color:var(--bg-page);padding:.1em .3em;border-radius:3px;font-size:.9em}.rc pre{background-color:var(--bg-page);padding:1em;border-radius:var(--rad);overflow-x:auto;margin-bottom:1.2em;font-size:.9em}.rc pre code{background-color:transparent;padding:0;border-radius:0;font-size:1em}#map-zoom-display svg:active{cursor:grabbing}#close-map-zoom-btn{position:absolute;top:16px;right:16px;background:#374151b3;color:white;border:none;border-radius:50%;width:36px;height:36px;font-size:20px;line-height:36px;text-align:center;cursor:pointer;z-index:1001;transition:background-color var(--anim-fast) ease,transform .15s ease}#close-map-zoom-btn:hover{background:#1f2937e6;transform:scale(1.05)}#gsp{position:fixed;background-color:#fff;color:#333;padding:6px 12px;border-radius:var(--rad);font-size:.8rem;font-weight:500;z-index:1050;border:1px solid #ccc;cursor:pointer;box-shadow:0 3px 8px #00000026;opacity:0;visibility:hidden;transition:opacity .15s ease,visibility 0s linear .15s,transform .15s ease;transform:translateY(8px) scale(.95);white-space:nowrap;display:inline-flex;align-items:center}#gsp.vis{opacity:1;visibility:visible;transform:translateY(0) scale(1);transition-delay:0s}#gsp svg{width:1.1em;height:1.1em;vertical-align:middle;margin-right:6px}#gsp:hover{background-color:#f8f9fa;border-color:#bbb}#pfb{position:fixed;top:16px;right:16px;z-index:1005;background-color:#ffffffd9;border:1px solid var(--bord-med);border-radius:50%;width:36px;height:36px;padding:0;display:flex;justify-content:center;align-items:center;cursor:pointer;box-shadow:0 1px 4px #0000001a;transition:background-color var(--anim-fast) ease,border-color var(--anim-fast) ease}#pfb:hover{background-color:white;border-color:var(--text-sec)}#pfb svg{width:18px;height:18px;fill:var(--text-sec);transition:fill var(--anim-fast) ease}#pfb:hover svg{fill:var(--text-pri)}@media (max-width:900px){.pw{margin:0;padding:0}.cc{border-radius:0;box-shadow:none}.la{flex-direction:column}.rc{border-right:none;border-bottom:1px solid var(--bord-soft);padding:20px}.ep{padding:20px;min-height:200px;position:static;height:auto;max-height:none;align-self:auto}.msh{padding:16px 20px 8px;flex-wrap:wrap}.msh h2{font-size:1.25rem;width:100%;margin-bottom:8px}.mhc{width:100%;justify-content:flex-end}#map-canvas-wrap{padding:16px 20px 20px}.rc h1{font-size:1.5rem}.ep h2{font-size:1.25rem}#pfb{top:10px;right:10px}}</style>

</head>

<body>

<button id="pfb" title="全屏"><svg class="ie" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg><svg class="ic" style="display:none" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path d="M5 16h3v3h2v-5H5v2zm3-8H5v2h5V5H8v3zm6 11h2v-3h3v-2h-5v5zm2-11V5h-2v5h5V8h-3z"/></svg></button>

<div class="pw">

<div class="cc">

<div class="la">

<main class="rc">

    <h1>互動式報告：AI 驅動社交工程與 LINE 投票詐騙的企業風險</h1>

    <p><strong>焦點</strong>：<span class="tm tmc" data-id="root_line_vote_scam" title="點擊查看">LINE 投票詐騙</span>如何結合<span class="tm tmc" data-id="social_engineering" title="點擊查看">社交工程</span>與<span class="tm tmc" data-id="ai_multiplier" title="點擊查看">生成式 AI 戰力倍增</span>，使<span class="tm tmb" data-id="enterprise_risk_matrix" title="點擊查看">企業風險矩陣</span>擴大；防禦側以<span class="tm tmc" data-id="zero_trust" title="點擊查看">零信任</span>、<span class="tm tmb" data-id="training" title="點擊查看">員工訓練</span>、<span class="tm tmb" data-id="incident_playbook" title="點擊查看">危機應變劇本</span>、<span class="tm tmt" data-id="ai_sentinel" title="點擊查看">AI 哨兵</span>與<span class="tm tmc" data-id="dtas_team" title="點擊查看">數位信任與安全團隊</span>建立韌性。</p>

    <p><strong>分析路線</strong>：</p>
    <ol>
        <li><span class="tm tmb" data-id="phishing_anatomy">釣魚解剖</span> → <span class="tm tmt" data-id="lure_social_bait">社交誘餌</span>、<span class="tm tmt" data-id="credential_theft">憑證竊取</span>（含<span class="tm tmt" data-id="sms_code_redflag">簡訊碼紅旗</span>）、<span class="tm tma" data-id="second_scam">二次詐騙</span>、<span class="tm tma" data-id="account_weaponization">帳號武器化</span></li>
        <li><span class="tm tmc" data-id="ai_multiplier">AI 倍增</span> → <span class="tm tmt" data-id="llm_polish">LLM 敘事完善</span>、<span class="tm tmt" data-id="deepfake">深度偽造</span>、<span class="tm tmb" data-id="aaS">攻擊即服務</span>、<span class="tm tmc" data-id="industrialization">工業化</span>與<span class="tm tmt" data-id="roi_shift">ROI 轉變</span></li>
        <li><span class="tm tmb" data-id="enterprise_risk_matrix">企業風險矩陣</span> → <span class="tm tmc" data-id="brand_impersonation">品牌冒用</span>、<span class="tm tmt" data-id="password_reuse">憑證重用</span>、<span class="tm tmt" data-id="intel_harvest">情資蒐集</span>、<span class="tm tma" data-id="malware_spread">惡意軟體傳播</span>、<span class="tm tmb" data-id="legal_financial">財法衝擊</span>、<span class="tm tmc" data-id="employee_boundary">邊界模糊與人體防火牆</span></li>
        <li><span class="tm tmb" data-id="incident_playbook">韌性框架</span> → <span class="tm tmt" data-id="evidence_collection">蒐證</span>、<span class="tm tma" data-id="public_comm">公開溝通</span>、<span class="tm tma" data-id="takedown">下架請求</span>、<span class="tm tma" data-id="legal_action">法律/報案</span>（含<span class="tm tma" data-id="id_165_hotline">165 專線</span>）、<span class="tm tmb" data-id="training">訓練</span>（<span class="tm tmt" data-id="oob_verify">帶外驗證</span>）、<span class="tm tmc" data-id="zero_trust">零信任</span>（<span class="tm tmt" data-id="mfa">MFA</span>、<span class="tm tmt" data-id="mail_filter">進階郵件過濾</span>、<span class="tm tmt" data-id="edr">EDR</span>）、<span class="tm tmb" data-id="brand_shield">品牌護盾</span>（<span class="tm tmt" data-id="monitoring">自動監控</span>、<span class="tm tma" data-id="official_presence">官方識別</span>）</li>
        <li><span class="tm tmc" data-id="arms_race">以 AI 對抗 AI</span> → <span class="tm tmt" data-id="ai_sentinel">AI 哨兵</span>（<span class="tm tmt" data-id="anomaly_detection">異常偵測</span>、<span class="tm tmt" data-id="explainability">可解釋性</span>）、<span class="tm tma" data-id="telco_platform_ai">平台/電信 AI 反詐欺</span>、<span class="tm tmb" data-id="supply_chain">供應商原生安全</span></li>
        <li><span class="tm tmc" data-id="strategy_resilience">韌性優先</span>、<span class="tm tmc" data-id="strategy_human_tech">人機協作防禦</span>、<span class="tm tmc" data-id="strategy_integrated">跨職能治理</span></li>
    </ol>

    <hr style="border:0;border-top:1px solid var(--bord-soft);margin:1.25em 0">

    <h3 style="margin-top:0">指標／公式</h3>
    <p><strong>攻擊投報</strong>：\\( ROI_{攻擊} = \\dfrac{p_{\\text{成功}}\\cdot V - C}{C} \\)。生成式 AI 使 \\(p_{\\text{成功}}\\uparrow\\)，內容自動化使 \\(C\\downarrow\\)，故 ROI 上升。</p>
    <p><strong>時間差</strong>：\\( \\Delta T = T_{\\text{攻擊者控制}} - T_{\\text{受害者恢復}} \\)。<span class="tm tma" data-id="second_scam">二次詐騙</span>透過假教學拉高 \\(T_{\\text{攻擊者控制}}\\)。</p>

    <h3>帶外驗證範例程式</h3>
    <pre><code class="language-python">from enum import Enum, auto

class Channel(Enum):
    IM = auto()
    EMAIL = auto()
    VOICE = auto()

def out_of_band_verify(request):
    """
    針對金流/密碼/存取權限的敏感請求，強制帶外驗證。
    規則：IM/Email 來的請求，一律改用通訊錄中「已存檔的官方電話」回撥確認。
    """
    if request.channel in (Channel.IM, Channel.EMAIL):
        number = directory.lookup_official_number(request.claimed_identity)
        ok = voice_call_and_verify(number, request.intent, request.amount)
        if not ok:
            raise PermissionError("帶外驗證失敗：拒絕執行")
    return True
</code></pre>

</main>

<aside class="ep">

<h2>概念詳解</h2>

<div id="explain-content" aria-live="polite"><p class="ph">點擊左側高亮術語或下方圖譜中的節點/關係以查看解釋。</p></div>

</aside>

</div>

<section class="ms">

<div class="msh">

<h2>概念圖譜</h2>

<div class="mhc">

<button id="map-zoom-btn" class="mcb" title="全屏查看與交互"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M7 14H5v5h5v-2H7v-3zm-2-4h2V7h3V5H5v5zm12 7h-3v2h5v-5h-2v3zM14 5v2h3v3h2V5h-5z"/></svg><span>全螢幕</span></button>

<button id="map-layout-btn" class="mcb" title="切換佈局方向">LR</button>

<button id="map-download-btn" class="mcb" title="下載關係圖 (PNG)"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/></svg><span>下載</span></button>

</div>

</div>

<div id="map-canvas-wrap"><div id="map-out"></div></div>

</section>

</div>

</div>

<div id="map-zoom-modal" class="mzm">

<div id="map-zoom-display" class="mzd"></div>

<button id="close-map-zoom-btn" class="czb" title="關閉">×</button>

</div>

<script>const notes={
root_line_vote_scam:{t:"LINE投票詐騙",type:"concept",d:"以投票/活動為餌誘導使用者連動 LINE，進而竊取憑證並接管帳號的複合型社交工程攻擊。",r:["phishing_anatomy","ai_multiplier","enterprise_risk_matrix","employee_boundary"]},
social_engineering:{t:"社交工程",type:"concept",d:"利用人類心理（熟悉、義務、恐慌）而非技術漏洞達成攻擊目的的手法集合。",r:["lure_social_bait","second_scam","enterprise_risk_matrix"]},
phishing_anatomy:{t:"現代釣魚攻擊的解剖學",type:"branch",d:"從情感誘導到憑證竊取，再到二次詐騙與帳號武器化的分階段心理作戰。",r:["lure_social_bait","credential_theft","second_scam","account_weaponization"]},
lure_social_bait:{t:"社交誘餌",type:"tech",d:"以熟人名義請求幫忙投票/按讚等低風險任務，繞過理性審查直擊情感與社交義務。",e:"常見劇本：寵物比賽投票、孩子畫作按讚。",r:["phishing_anatomy","social_engineering"]},
credential_theft:{t:"憑證竊取流程",type:"tech",d:"仿冒登入頁要求輸入電話、密碼，並誘導填寫簡訊驗證碼以完成完全接管。",e:"頁面高度擬真且要求「連動 LINE 帳號」方能投票。",r:["phishing_anatomy","sms_code_redflag"]},
sms_code_redflag:{t:"簡訊認證碼紅旗",type:"tech",d:"正規網頁端流程不需輸入 SMS 驗證碼；若被要求，幾乎可確定為釣魚。",r:["credential_theft"]},
second_scam:{t:"二次詐騙",type:"app",d:"攻擊者在奪帳後以假身分回撥，提供「假教學」延長控制時間、阻斷受害者自救。",e:"指示刪 APP、重開機、不改密碼、裝所謂防毒等。",r:["phishing_anatomy","fake_it_guidance"]},
fake_it_guidance:{t:"假教學阻斷救援",type:"tech",d:"以看似標準 IT SOP 的錯誤指引製造時間差，擴大入侵窗口。",r:["second_scam"]},
account_weaponization:{t:"帳號武器化",type:"app",d:"用奪取的帳號向通訊錄擴散詐騙/植入惡意鏈結，形成連鎖傳播。",r:["phishing_anatomy","brand_impersonation"]},

ai_multiplier:{t:"AI 戰力倍增器",type:"concept",d:"生成式 AI 不創造新類型詐騙，但顯著提升速率、規模與擬真度，放大既有社工手法。",r:["llm_polish","deepfake","aaS","industrialization"]},
llm_polish:{t:"LLM 敘事完善",type:"tech",d:"大型語言模型去除語法破綻、模仿文風，量產個人化詐騙劇本。",r:["ai_multiplier"]},
deepfake:{t:"深度偽造",type:"tech",d:"以合成語音/影像進行更高階身分冒用，提升說服力。",e:"例：以在地商家影像與相似聲音製作促銷廣告行騙。",r:["ai_multiplier","brand_impersonation","arms_race"]},
aaS:{t:"攻擊即服務",type:"branch",d:"工具化、平台化的詐騙流水線：抓資、劇本、假站、聊天機器人一條龍自動化。",r:["ai_multiplier","industrialization"]},
industrialization:{t:"網路犯罪工業化",type:"concept",d:"大規模、自動化、低門檻地生產高品質釣魚與偽站，數量與品質同步上升。",r:["ai_multiplier","roi_shift"]},
roi_shift:{t:"攻擊 ROI 轉變",type:"tech",d:"AI 讓成功率上升、成本下降，攻擊投報大幅提高。",r:["industrialization"]},

enterprise_risk_matrix:{t:"企業風險矩陣",type:"branch",d:"品牌遭冒用的直接損害與員工個人失陷導致的間接入侵雙線並行。",r:["brand_impersonation","password_reuse","intel_harvest","malware_spread","legal_financial","employee_boundary","risk_matrix"]},
brand_impersonation:{t:"品牌冒用",type:"concept",d:"未授權使用商標/名義行騙，侵蝕商譽與客戶信任並衍生大量客服/公關成本。",r:["enterprise_risk_matrix","incident_playbook","brand_shield","deepfake"]},
password_reuse:{t:"憑證重用風險",type:"tech",d:"員工跨服務重用密碼，個人帳密外洩成為進入企業郵件/VPN/雲端的捷徑。",r:["enterprise_risk_matrix","zero_trust","mfa"]},
intel_harvest:{t:"情資蒐集跳板",type:"tech",d:"潛伏個人帳號蒐集同事/架構/專案資訊，為魚叉式攻擊提供素材。",r:["enterprise_risk_matrix","training"]},
malware_spread:{t:"惡意軟體傳播",type:"app",d:"以被駭帳號向內部散播含惡意附件/連結的訊息，提高點擊率。",r:["enterprise_risk_matrix","edr"]},
legal_financial:{t:"財務與法律衝擊",type:"branch",d:"BEC 欺騙轉帳、個資外洩通報/罰責與可能的連帶賠償。",r:["enterprise_risk_matrix","legal_action"]},
employee_boundary:{t:"企業邊界模糊與人體防火牆",type:"concept",d:"員工個人數位生活成為企業攻擊面，傳統網路邊界模型失效。",r:["enterprise_risk_matrix","training"]},
risk_matrix:{t:"風險矩陣",type:"branch",d:"直接攻擊與間接入侵影響面向的系統性盤點與量化。",r:["brand_impersonation","password_reuse","intel_harvest","malware_spread","legal_financial"]},

incident_playbook:{t:"危機應變劇本",type:"branch",d:"品牌遭冒用等事件的分秒必爭行動協議。",r:["evidence_collection","public_comm","takedown","legal_action"]},
evidence_collection:{t:"蒐證存檔",type:"tech",d:"完整保全偽站 URL、釣魚文案、受害回報的截圖與指紋，作為申訴與法律依據。",r:["incident_playbook"]},
public_comm:{t:"迅速公開溝通",type:"app",d:"以官網/社群/電子報同步發布統一聲明與正確聯繫/交易途徑，切斷受害來源。",r:["incident_playbook"]},
takedown:{t:"向平台下架請求",type:"app",d:"透過平台檢舉機制附商登/商標文件，要求緊急移除冒名帳號與網域。",r:["incident_playbook","brand_shield"]},
legal_action:{t:"法律與報案程序",type:"app",d:"報案、存證、商標/詐欺/名譽等刑民事行動，降低損害並嚇阻。",r:["incident_playbook","id_165_hotline"]},
id_165_hotline:{t:"165反詐騙專線",type:"app",d:"台灣官方詐騙通報/諮詢管道，納入劇本以加速串接執法。",r:["legal_action"]},

training:{t:"員工訓練：數位懷疑論",type:"branch",d:"從找錯字升級為對製造緊迫感與偏離流程的訊息保持高警覺。",r:["oob_verify","intel_harvest"]},
oob_verify:{t:"帶外驗證",type:"tech",d:"金流/密碼/存取請求，一律以獨立安全通道（撥打已存官方電話或面對面）二次確認。",r:["training"]},

zero_trust:{t:"零信任架構",type:"concept",d:"預設不信任任何內外來源，每次存取皆重新驗證與授權。",r:["mfa","mail_filter","edr"]},
mfa:{t:"多重要素驗證（MFA）",type:"tech",d:"即便密碼外洩，因缺乏第二因子而難以登入。",r:["zero_trust","password_reuse"]},
mail_filter:{t:"進階郵件過濾",type:"tech",d:"以 NLP/行為分析偵測 BEC 與魚叉式釣魚。",r:["zero_trust"]},
edr:{t:"端點偵測與應變（EDR）",type:"tech",d:"端點行為持續監控與自動隔離，防止威脅橫向擴散。",r:["zero_trust","malware_spread"]},

brand_shield:{t:"主動品牌護盾",type:"branch",d:"前置監控與官方認證，降低被假冒成功率。",r:["monitoring","official_presence","takedown"]},
monitoring:{t:"自動化監控",type:"tech",d:"掃描相似網域、偽冒帳號與開放論壇/暗網提及，提早處置。",r:["brand_shield"]},
official_presence:{t:"官方識別/認證",type:"app",d:"在主要平台建立並驗證官方帳號，讓用戶易於辨識真偽。",r:["brand_shield"]},

dtas_team:{t:"數位信任與安全團隊",type:"concept",d:"整合資安、法務、公關、客服的常設跨職能單位，具即時決策權。",r:["incident_playbook","brand_shield","training"]},

ai_sentinel:{t:"AI 哨兵",type:"tech",d:"以機器學習建立「正常行為」基線，偵測異常並自動應變。",r:["anomaly_detection","explainability","telco_platform_ai"]},
anomaly_detection:{t:"異常行為識別",type:"tech",d:"偵測非正常時間/地點登入、越權存取、語言風格突變等。",r:["ai_sentinel"]},
explainability:{t:"可解釋性",type:"tech",d:"不只標記惡意，還能說明判斷原因，利於溯源與改善。",r:["ai_sentinel"]},
telco_platform_ai:{t:"平台/電信AI反詐欺",type:"app",d:"平台與電信業者用大規模模型封鎖偽站/詐騙樣式，打造社會層級防護。",r:["ai_sentinel","supply_chain"]},
arms_race:{t:"AI攻防軍備競賽",type:"concept",d:"攻擊轉向聲影深偽；防禦研發偵測細微不一致的媒體取證 AI。",r:["deepfake","ai_sentinel"]},
supply_chain:{t:"供應商原生AI安全",type:"branch",d:"單一企業難以自建全球威脅視野，需評估雲/軟體/電信供應商的原生安全能力。",r:["telco_platform_ai"]},

strategy_resilience:{t:"韌性優先",type:"concept",d:"假設入侵終會發生，強化偵測、應變與復原。",r:["incident_playbook","ai_sentinel"]},
strategy_human_tech:{t:"人機協作防禦",type:"concept",d:"同時投資 AI 工具與員工訓練，形成疊代防禦。",r:["training","ai_sentinel"]},
strategy_integrated:{t:"跨職能治理",type:"concept",d:"破除部門藩籬，以常設整合中心協調即時行動。",r:["dtas_team"]}
};

const typeStyles={
concept:{fillcolor:"#fef3c7",cssClass:"tmc"},
branch:{fillcolor:"#d1fae5",cssClass:"tmb"},
tech:{fillcolor:"#dbeafe",cssClass:"tmt"},
app:{fillcolor:"#fee2e2",cssClass:"tma"},
default:{fillcolor:"#e0e0e0",cssClass:"tmc"}
};

const graphEdges="
root_line_vote_scam -> phishing_anatomy [label=\"案例\"]; 
root_line_vote_scam -> ai_multiplier [label=\"被強化\"]; 
root_line_vote_scam -> enterprise_risk_matrix [label=\"導致\"]; 
root_line_vote_scam -> employee_boundary [label=\"凸顯\"]; 

phishing_anatomy -> lure_social_bait [label=\"步驟1\"]; 
phishing_anatomy -> credential_theft [label=\"步驟2\"]; 
phishing_anatomy -> second_scam [label=\"步驟3\"]; 
phishing_anatomy -> account_weaponization [label=\"後續\"]; 
credential_theft -> sms_code_redflag [label=\"特徵\"]; 
second_scam -> fake_it_guidance [label=\"策略\"]; 

ai_multiplier -> llm_polish [label=\"提升文本\"]; 
ai_multiplier -> deepfake [label=\"合成媒體\"]; 
ai_multiplier -> aaS [label=\"降低門檻\"]; 
ai_multiplier -> industrialization [label=\"推動\"]; 
industrialization -> roi_shift [label=\"改變\"]; 

enterprise_risk_matrix -> brand_impersonation [label=\"直接攻擊\"]; 
enterprise_risk_matrix -> password_reuse [label=\"間接入侵\"]; 
enterprise_risk_matrix -> intel_harvest [label=\"間接入侵\"]; 
enterprise_risk_matrix -> malware_spread [label=\"間接入侵\"]; 
enterprise_risk_matrix -> legal_financial [label=\"後果\"]; 
enterprise_risk_matrix -> employee_boundary [label=\"環境\"]; 
enterprise_risk_matrix -> risk_matrix [label=\"量化\"]; 

incident_playbook -> evidence_collection [label=\"行動1\"]; 
incident_playbook -> public_comm [label=\"行動2\"]; 
incident_playbook -> takedown [label=\"行動3\"]; 
incident_playbook -> legal_action [label=\"行動4\"]; 
legal_action -> id_165_hotline [label=\"通報\"]; 

training -> oob_verify [label=\"關鍵\"]; 

zero_trust -> mfa [label=\"包含\"]; 
zero_trust -> mail_filter [label=\"包含\"]; 
zero_trust -> edr [label=\"包含\"]; 

brand_shield -> monitoring [label=\"包含\"]; 
brand_shield -> official_presence [label=\"包含\"]; 
brand_shield -> takedown [label=\"協同\"]; 

dtas_team -> incident_playbook [label=\"協作\"]; 
dtas_team -> brand_shield [label=\"協作\"]; 
dtas_team -> training [label=\"協作\"]; 

ai_sentinel -> anomaly_detection [label=\"方法\"]; 
ai_sentinel -> explainability [label=\"需求\"]; 
ai_sentinel -> telco_platform_ai [label=\"生態\"]; 
arms_race -> deepfake [label=\"對抗\"]; 
arms_race -> ai_sentinel [label=\"對抗\"]; 

supply_chain -> telco_platform_ai [label=\"仰賴\"]; 

strategy_resilience -> incident_playbook [label=\"落地\"]; 
strategy_resilience -> ai_sentinel [label=\"落地\"]; 
strategy_human_tech -> training [label=\"落地\"]; 
strategy_human_tech -> ai_sentinel [label=\"落地\"]; 
strategy_integrated -> dtas_team [label=\"落地\"]; 
";

const gIcon='<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 48 48\"><path fill=\"#EA4335\" d=\"M24 9.5c3.54 0 6.71 1.22 9.21 3.6l6.85-6.85C35.9 2.38 30.47 0 24 0 14.62 0 6.51 5.38 2.56 13.22l7.98 6.19C12.43 13.72 17.74 9.5 24 9.5z\"/><path fill=\"#4285F4\" d=\"M46.98 24.55c0-1.57-.15-3.09-.38-4.55H24v9.02h12.94c-.58 2.96-2.26 5.48-4.78 7.18l7.73 6c4.51-4.18 7.09-10.36 7.09-17.65z\"/><path fill=\"#FBBC05\" d=\"M10.53 28.72c-.79-2.36-.79-4.9 0-7.27l-7.98-6.19C.92 18.05 0 21.13 0 24.27s.92 6.22 2.56 8.74l7.97-6.03z\"/><path fill=\"#34A853\" d=\"M24 48c6.48 0 11.93-2.13 15.89-5.81l-7.73-6c-2.15 1.45-4.92 2.3-8.16 2.3-6.26 0-11.57-4.22-13.47-9.91l-7.98 6.19C6.51 42.62 14.62 48 24 48z\"/><path fill=\"none\" d=\"M0 0h48v48H0z\"/></svg>',POPUP_Y_OFF=8;let srchPop=null,hidePopTimeout=null,selectedLabelElement=null,originalLabelFill='';function genD(rd,allN,termIds){let d=`digraph AIInstructionConcepts {graph [labelloc=t,label="AI指令概念图谱",fontsize=16,fontname="-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif",bgcolor=transparent,rankdir="${rd}",nodesep=.4,ranksep=.6];node [fontname="-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif",fontsize=10,style=filled,shape=box,margin=".12,.06",color="#d1d5db",fontcolor="#1f2937"];edge [fontsize=9,color="#6b7280",fontname="-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,Helvetica,Arial,sans-serif",arrowsize=.7,fontcolor="#1f2937"];`;for(const id in allN){if(id in allN){const n=allN[id];if(n.hideFromGraph)continue;const s=typeStyles[n.type]||typeStyles.default;let nodeAttrs=`label="${n.t.replace(/"/g,'\\"')}", fillcolor="${s.fillcolor}", id="node-${id}", "data-ia"="${termIds.has(id)||!!Object.values(allN).find(item=>!item.hideFromGraph&&item.r&&item.r.includes(id))}"`;if(!termIds.has(id)){nodeAttrs+=', fontcolor="var(--map-node-non-interactive-font-color)", color="var(--map-node-non-interactive-border-color)", style="filled,dashed"'}d+=`${id} [${nodeAttrs}];\n`}}d+=graphEdges.replace(/([a-zA-Z0-9_]+)\s*->\s*([a-zA-Z0-9_]+)/g,(m,p1,p2)=>`${p1}->${p2}`);return d+"\n}"}

function mkPop(){if(!srchPop){srchPop=document.createElement('button');srchPop.id='gsp';srchPop.type='button';srchPop.innerHTML=`${gIcon}<span>搜索</span>`;document.body.appendChild(srchPop);srchPop.addEventListener('mouseover',()=>{hidePopTimeout&&clearTimeout(hidePopTimeout)});srchPop.addEventListener('mouseout',()=>{hidePopTimeout=setTimeout(()=>srchPop.classList.remove('vis'),300)});srchPop.addEventListener('click',e=>{const q=e.currentTarget.dataset.st;q&&(window.open(`https://www.google.com/search?q=${encodeURIComponent(q)}`,'_blank','noopener,noreferrer'),srchPop.classList.remove('vis'))})}}

function dnldMap(){const svgEl=document.querySelector("#map-out svg");if(!svgEl){alert("未找到关系图SVG元素。");return}const cnv=document.createElement('canvas'),ctx=cnv.getContext('2d'),rect=svgEl.getBoundingClientRect(),scl=2;cnv.width=rect.width*scl;cnv.height=rect.height*scl;ctx.fillStyle='white';ctx.fillRect(0,0,cnv.width,cnv.height);const svgStr=new XMLSerializer().serializeToString(svgEl),img=new Image,svgBlb=new Blob([svgStr],{type:'image/svg+xml;charset=utf-8'}),url=URL.createObjectURL(svgBlb);img.onload=function(){ctx.drawImage(img,0,0,cnv.width,cnv.height);URL.revokeObjectURL(url);const pngUrl=cnv.toDataURL('image/png'),dLnk=document.createElement('a');dLnk.href=pngUrl;dLnk.download='instruction-knowledge-graph.png';document.body.appendChild(dLnk);dLnk.click();document.body.removeChild(dLnk)};img.onerror=()=>{URL.revokeObjectURL(url);alert("下载关系图失败：无法加载SVG图像。")};img.src=url}

document.addEventListener('DOMContentLoaded',()=>{const qsA=s=>document.querySelectorAll(s),qs=s=>document.querySelector(s),gId=id=>document.getElementById(id),allTs=qsA('.rc .tm[data-id]'),expEl=gId('explain-content'),pfBtn=gId('pfb'),mapO=gId('map-out'),zmB=gId('map-zoom-btn'),lytB=gId('map-layout-btn'),dlB=gId('map-download-btn'),zModal=gId('map-zoom-modal'),zDisp=gId('map-zoom-display'),clzmB=gId('close-map-zoom-btn');let actT=null,actMId=null,pnz=null,curLyt='LR';const rdTIds=new Set;allTs.forEach(s=>rdTIds.add(s.dataset.id));let viz;try{viz=new Viz}catch(err){console.error("Failed to initialize Viz.js. Knowledge graph functionality will be unavailable.",err);mapO&&(mapO.innerHTML='<p style="color:red;font-size:.8em;padding:10px;">错误：概念图谱库 (Viz.js) 加载失败。</p>');lytB&&(lytB.disabled=!0);dlB&&(dlB.disabled=!0);zmB&&(zmB.disabled=!0)}

function hiMNode(id){if(actMId){const pN=qs(`#map-out svg g.node[id="${actMId}"]`);pN&&pN.classList.remove('mna')}const mId=`node-${id}`,mN=qs(`#map-out svg g.node[id="${mId}"]`);mN?(mN.classList.add('mna'),actMId=mId):actMId=null}

function clrMHi(){if(actMId){const mN=qs(`#map-out svg g.node[id="${actMId}"]`);mN&&mN.classList.remove('mna');actMId=null}

function shwExpl(id,fromPanel=0){if(selectedLabelElement){selectedLabelElement.style.fontWeight='normal';selectedLabelElement.style.fill=originalLabelFill;selectedLabelElement=null;originalLabelFill=''}const noteD=notes[id];actT&&actT.classList.remove('active');const tmInRc=qs(`.rc .tm[data-id="${id}"]`);tmInRc?(tmInRc.classList.add('active'),actT=tmInRc,fromPanel&&!isVis(tmInRc)&&tmInRc.scrollIntoView({behavior:'smooth',block:'center'})):actT=null;noteD&&!noteD.hideFromGraph?hiMNode(id):clrMHi();if(noteD){let h=`<div class="ei"><div class="eih"><h3>${noteD.t}</h3><button type="button" class="gsb" data-st="${noteD.t.replace(/"/g,'&quot;')}" title="用 Google 搜索 '${noteD.t.replace(/"/g,"&quot;")}'">${gIcon}</button></div>`;noteD.d&&(h+=`<p><strong>定義：</strong> ${noteD.d}</p>`);noteD.e&&(h+=`<p><strong>例子：</strong> ${noteD.e}</p>`);if(noteD.r?.length){h+=`<p><strong>相關概念：</strong> `;h+=noteD.r.map(rId=>{const rN=notes[rId];if(!rN)return`<span class="tm tmc" data-id="${rId}" title="未知概念">${rId}</span>`;let cls='';const rTIT=qs(`.rc .tm[data-id="${rId}"]`);rTIT?(cls=Array.from(rTIT.classList).find(c=>c.startsWith('tm')&&c.length===3),cls||(cls=(typeStyles[rN.type]||typeStyles.default).cssClass)):cls=(typeStyles[rN.type]||typeStyles.default).cssClass;return`<span class="tm ${cls}" data-id="${rId}" title="點擊查看">${rN.t}</span>`}).join('、 ');h+='</p>'}expEl.innerHTML=h+'</div>';MathJax?.typesetPromise?.([expEl]).catch(err=>console.error('MathJax typeset error:',err))}else expEl.innerHTML='<p class="ph">未找到此術語的解釋。</p>'}

function isVis(el){const rect=el.getBoundingClientRect();return rect.top>=0&&rect.left>=0&&rect.bottom<=(window.innerHeight||document.documentElement.clientHeight)&&rect.right<=(window.innerWidth||document.documentElement.clientWidth)}

function clrExpl(){actT&&actT.classList.remove('active');actT=null;clrMHi();if(selectedLabelElement){selectedLabelElement.style.fontWeight='normal';selectedLabelElement.style.fill=originalLabelFill;selectedLabelElement=null;originalLabelFill=''}expEl.innerHTML='<p class="ph">點擊左側高亮術語或下方圖譜中的節點/關係以查看解釋。</p>'}

const firstT=qs('.rc .tm.tmc[data-id]');allTs.forEach(s=>s.addEventListener('click',function(){this===actT&&expEl.querySelector('.ei h3')?.textContent===notes[this.dataset.id]?.t?clrExpl():shwExpl(this.dataset.id)}));

expEl.addEventListener('click',e=>{const t=e.target.closest('.tm'),b=e.target.closest('.gsb');if(t?.dataset.id){const curExplH3=expEl.querySelector('.ei h3');notes[t.dataset.id]&&curExplH3&&curExplH3.textContent===notes[t.dataset.id].t?(qs(`.rc .tm.active[data-id="${t.dataset.id}"]`)?clrExpl():(shwExpl(t.dataset.id,1),expEl.parentElement.scrollTop=0)):(shwExpl(t.dataset.id,1),expEl.parentElement.scrollTop=0)}else b?.dataset.st&&window.open(`https://www.google.com/search?q=${encodeURIComponent(b.dataset.st)}`,'_blank','noopener,noreferrer')});

expEl.addEventListener('mouseover',e=>{const targetEl=e.target.closest('.tm');if(targetEl?.dataset.id&&targetEl.parentElement?.tagName==='P'&&targetEl.parentElement.firstChild?.tagName==='STRONG'&&targetEl.parentElement.firstChild.textContent.includes('相關概念')){mkPop();hidePopTimeout&&clearTimeout(hidePopTimeout);const id=targetEl.dataset.id,d=notes[id],sT=d?d.t:targetEl.textContent.trim();srchPop.dataset.st=sT;srchPop.querySelector('span').textContent=`搜索 "${sT.length>18?sT.substring(0,16)+'...':sT}"`;srchPop.classList.remove('vis');const r=targetEl.getBoundingClientRect(),popW=srchPop.offsetWidth,popH=srchPop.offsetHeight;let l=r.left+r.width/2-popW/2,t=r.top-popH-POPUP_Y_OFF;l<POPUP_Y_OFF&&(l=POPUP_Y_OFF);l+popW>innerWidth-POPUP_Y_OFF&&(l=innerWidth-popW-POPUP_Y_OFF);t<POPUP_Y_OFF&&(t=r.bottom+POPUP_Y_OFF,t+popH>innerHeight-POPUP_Y_OFF&&(t=r.top+r.height/2-popH/2));srchPop.style.left=`${l}px`;srchPop.style.top=`${t}px`;srchPop.classList.add('vis')}});

expEl.addEventListener('mouseout',e=>{const targetEl=e.target.closest('.tm');targetEl?.dataset.id&&targetEl.parentElement?.tagName==='P'&&targetEl.parentElement.firstChild?.tagName==='STRONG'&&targetEl.parentElement.firstChild.textContent.includes('相關概念')&&srchPop&&(hidePopTimeout&&clearTimeout(hidePopTimeout),hidePopTimeout=setTimeout(()=>{srchPop.matches(':hover')||srchPop.classList.remove('vis')},200))});

mapO.addEventListener('click',e=>{const target=e.target;let nodeElement=null,currentElementForNodeSearch=target;while(currentElementForNodeSearch&&currentElementForNodeSearch!==mapO){if(currentElementForNodeSearch.matches?.('g.node[id^="node-"]')){nodeElement=currentElementForNodeSearch;break}currentElementForNodeSearch=currentElementForNodeSearch.parentNode}if(nodeElement){if(selectedLabelElement){selectedLabelElement.style.fontWeight='normal';selectedLabelElement.style.fill=originalLabelFill;selectedLabelElement=null;originalLabelFill=''}const id=nodeElement.id.substring(5);if(notes[id]&&!notes[id].hideFromGraph&&nodeElement.dataset.ia!=="false"){const curExplH3=expEl.querySelector('.ei h3');actMId===nodeElement.id&&curExplH3&&notes[id]&&curExplH3.textContent===notes[id].t?clrExpl():(shwExpl(id,1),expEl.parentElement.scrollTop=0)}return}if(target.localName==='text'){const parentG=target.parentNode;if(parentG?.localName==='g'&&parentG.classList.contains('edge')){const labelText=target.textContent.trim();if(labelText){actT&&(actT.classList.remove('active'),actT=null);clrMHi();if(selectedLabelElement===target){target.style.fontWeight='normal';target.style.fill=originalLabelFill;selectedLabelElement=null;originalLabelFill='';clrExpl();return}selectedLabelElement&&selectedLabelElement!==target&&(selectedLabelElement.style.fontWeight='normal',selectedLabelElement.style.fill=originalLabelFill);originalLabelFill=target.style.fill||target.getAttribute('fill')||'var(--text-pri)';target.style.fontWeight='bold';target.style.fill='var(--brand)';selectedLabelElement=target;let html=`<div class="ei"><div class="eih"><h3>關係類型: ${labelText}</h3><button type="button" class="gsb" data-st="${labelText.replace(/"/g,'&quot;')}" title="用 Google 搜索 '${labelText.replace(/"/g,'&quot;')}'">${gIcon}</button></div><p>此標籤描述圖譜中兩個概念之間的關係類型。</p><p>你可以使用按鈕搜尋「<strong>${labelText}</strong>」的更多資訊。</p></div>`;expEl.innerHTML=html;MathJax?.typesetPromise?.([expEl]).catch(err=>console.error('MathJax typeset error:',err));expEl.parentElement.scrollTop=0}}}});

const pzWheel=e=>{pnz?.zoomWithWheel&&(e.preventDefault(),pnz.zoomWithWheel(e))};

function updLBtn(){lytB.textContent=curLyt==='TB'?'LR':'TB';lytB.title=`切換到 ${curLyt==='TB'?'LR':'TB'} 佈局`}updLBtn();

async function rndrMap(rd){if(!viz||!mapO){!viz&&mapO&&!mapO.querySelector('p[style*="color:red"]')&&(mapO.innerHTML='<p style="color:red;font-size:.8em;padding:10px;">错误：概念图谱库 (Viz.js) 未初始化，无法渲染图谱。</p>');return}lytB.disabled=!0;dlB&&(dlB.disabled=!0);mapO.classList.add('ld');lytB.innerHTML='<svg viewBox="0 0 24 24" style="width:1.1em;height:1.1em;fill:currentColor"><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z" opacity=".3"/><path d="M12 4V1L8 5l4 4V6c3.31 0 6 2.69 6 6s-2.69 6-6 6-6-2.69-6-6H4c0 4.42 3.58 8 8 8s8-3.58 8-8-3.58-8-8-8z"/></svg> <span>...</span>';if(selectedLabelElement){selectedLabelElement=null;originalLabelFill=''}const dotStr=genD(rd,notes,rdTIds);try{const svgRend=await viz.renderSVGElement(dotStr);mapO.innerHTML='';mapO.appendChild(svgRend);const activeTermId=actT?actT.dataset.id:null;activeTermId&&notes[activeTermId]&&!notes[activeTermId].hideFromGraph?hiMNode(activeTermId):actMId&&(notes[actMId.substring(5)]&&!notes[actMId.substring(5)].hideFromGraph?hiMNode(actMId.substring(5)):clrMHi());const svgCln=svgRend.cloneNode(!0);zDisp.innerHTML='';zDisp.appendChild(svgCln);const pzEl=zDisp.querySelector('svg');if(pnz?.destroy){const oldPnz=pnz.getPan()?.parentElement;oldPnz&&oldPnz.removeEventListener('wheel',pzWheel);pnz.destroy();pnz=null}pzEl&&(pnz=Panzoom(pzEl,{maxZoom:10,minZoom:.1,contain:'outside',canvas:!0,duration:200,easing:'ease-out'}),zDisp.addEventListener('wheel',pzWheel,{passive:!1}))}catch(err){console.error("Error rendering Map SVG:",err);mapO.innerHTML=`<p style="color:red;font-size:.8em;padding:10px;">概念圖渲染失敗: ${err.message}</p>`}finally{curLyt=rd;updLBtn();lytB.disabled=!1;dlB&&(dlB.disabled=!1);mapO.classList.remove('ld')}}

viz?rndrMap(curLyt).then(()=>{firstT?.dataset.id&&shwExpl(firstT.dataset.id)}):firstT?.dataset.id&&shwExpl(firstT.dataset.id);

lytB.addEventListener('click',()=>rndrMap(curLyt==='TB'?'LR':'TB'));

zmB.addEventListener('click',()=>{zModal.classList.add('vis');pnz?.reset?.({animate:!1});clzmB.focus();pfBtn&&(pfBtn.style.display='none')});

dlB?.addEventListener('click',dnldMap);function hidZm(){zModal.classList.remove('vis');pfBtn&&(pfBtn.style.display='flex')}clzmB.addEventListener('click',hidZm);

zModal.addEventListener('click',e=>{e.target===zModal&&hidZm()});document.addEventListener('keydown',e=>{e.key==='Escape'&&zModal.classList.contains('vis')&&hidZm()});

const fsIconE=pfBtn.querySelector('.ie'),fsIconC=pfBtn.querySelector('.ic');

function tglFs(){const doc=document;!doc.fullscreenElement&&!doc.mozFullScreenElement&&!doc.webkitFullscreenElement&&!doc.msFullscreenElement?(doc.documentElement.requestFullscreen?doc.documentElement.requestFullscreen():doc.documentElement.mozRequestFullScreen?doc.documentElement.mozRequestFullScreen():doc.documentElement.webkitRequestFullscreen?doc.documentElement.webkitRequestFullscreen(Element.ALLOW_KEYBOARD_INPUT):doc.documentElement.msRequestFullscreen&&doc.documentElement.msRequestFullscreen()):doc.exitFullscreen?doc.exitFullscreen():doc.mozCancelFullScreen?doc.mozCancelFullScreen():doc.webkitExitFullscreen?doc.webkitExitFullscreen():doc.msExitFullscreen&&doc.msExitFullscreen()}

function updFsBtn(){const doc=document;doc.fullscreenElement||doc.mozFullScreenElement||doc.webkitFullscreenElement||doc.msFullscreenElement?(fsIconE.style.display='none',fsIconC.style.display='block',pfBtn.title="退出全屏"):(fsIconE.style.display='block',fsIconC.style.display='none',pfBtn.title="全屏")}

pfBtn&&(pfBtn.style.display='flex',pfBtn.addEventListener('click',tglFs),['fullscreenchange','webkitfullscreenchange','mozfullscreenchange','MSFullscreenChange'].forEach(evt=>document.addEventListener(evt,updFsBtn)),updFsBtn())});</script>

</body>

</html>
